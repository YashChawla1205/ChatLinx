"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/server";
exports.ids = ["pages/api/server"];
exports.modules = {

/***/ "crypto-js":
/*!****************************!*\
  !*** external "crypto-js" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("crypto-js");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "socket.io":
/*!****************************!*\
  !*** external "socket.io" ***!
  \****************************/
/***/ ((module) => {

module.exports = import("socket.io");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fserver&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cserver%5Cindex.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fserver&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cserver%5Cindex.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_server_index_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src\\pages\\api\\server\\index.ts */ \"(api)/./src/pages/api/server/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_server_index_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_server_index_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_server_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_server_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/server\",\n        pathname: \"/api/server\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_server_index_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnNlcnZlciZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnNyYyU1Q3BhZ2VzJTVDYXBpJTVDc2VydmVyJTVDaW5kZXgudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDZ0U7QUFDaEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLDJEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywyREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93aGlzY2hhdC8/YjIyMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vc3JjXFxcXHBhZ2VzXFxcXGFwaVxcXFxzZXJ2ZXJcXFxcaW5kZXgudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zZXJ2ZXJcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zZXJ2ZXJcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fserver&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cserver%5Cindex.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/pages/api/server/index.ts":
/*!***************************************!*\
  !*** ./src/pages/api/server/index.ts ***!
  \***************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var socket_io__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! socket.io */ \"socket.io\");\n/* harmony import */ var _server_handlers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/handlers */ \"(api)/./src/server/handlers.ts\");\n/* harmony import */ var _server_handlerDecorator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/handlerDecorator */ \"(api)/./src/server/handlerDecorator.ts\");\n/* harmony import */ var _server_service_mongo__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/service/mongo */ \"(api)/./src/server/service/mongo.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([socket_io__WEBPACK_IMPORTED_MODULE_0__]);\nsocket_io__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/server.ts\n\n\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (async (req, res)=>{\n    try {\n        if (res.socket.server.io) {\n            console.log(\"Already set up\");\n            await (0,_server_service_mongo__WEBPACK_IMPORTED_MODULE_3__[\"default\"])();\n            res.end();\n            return;\n        }\n        const io = new socket_io__WEBPACK_IMPORTED_MODULE_0__.Server(res.socket.server, {\n            cors: {\n                origin: \"*\"\n            }\n        });\n        await (0,_server_service_mongo__WEBPACK_IMPORTED_MODULE_3__[\"default\"])();\n        // Event handler for client connections\n        io.on(\"connection\", (socket)=>{\n            const clientId = socket.id;\n            console.log(`A client connected. ID: ${clientId}`);\n            (0,_server_handlerDecorator__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(io, socket, Object.values(_server_handlers__WEBPACK_IMPORTED_MODULE_1__));\n            // Event handler for client disconnections\n            socket.on(\"disconnect\", ()=>{\n                console.log(\"A client disconnected.\");\n            });\n        });\n        res.socket.server.io = io;\n        res.end();\n    } catch (error) {\n        console.error(error);\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL3NlcnZlci9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLHNCQUFzQjtBQUVxQjtBQUlHO0FBQ1U7QUFFTjtBQWNsRCxpRUFBZSxPQUFPSSxLQUFxQkM7SUFDekMsSUFBSTtRQUNGLElBQUlBLElBQUlDLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDQyxFQUFFLEVBQUU7WUFDeEJDLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE1BQU1QLGlFQUFZQTtZQUNsQkUsSUFBSU0sR0FBRztZQUNQO1FBQ0Y7UUFFQSxNQUFNSCxLQUFLLElBQUlSLDZDQUFNQSxDQUFDSyxJQUFJQyxNQUFNLENBQUNDLE1BQU0sRUFBRTtZQUN2Q0ssTUFBTTtnQkFBRUMsUUFBUTtZQUFJO1FBQ3RCO1FBRUEsTUFBTVYsaUVBQVlBO1FBRWxCLHVDQUF1QztRQUN2Q0ssR0FBR00sRUFBRSxDQUFDLGNBQWMsQ0FBQ1I7WUFDbkIsTUFBTVMsV0FBV1QsT0FBT1UsRUFBRTtZQUMxQlAsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0JBQXdCLEVBQUVLLFNBQVMsQ0FBQztZQUVqRGIsb0VBQWVBLENBQUNNLElBQUlGLFFBQVFXLE9BQU9DLE1BQU0sQ0FBQ2pCLDZDQUFRQTtZQUVsRCwwQ0FBMEM7WUFDMUNLLE9BQU9RLEVBQUUsQ0FBQyxjQUFjO2dCQUN0QkwsUUFBUUMsR0FBRyxDQUFDO1lBQ2Q7UUFDRjtRQUVBTCxJQUFJQyxNQUFNLENBQUNDLE1BQU0sQ0FBQ0MsRUFBRSxHQUFHQTtRQUN2QkgsSUFBSU0sR0FBRztJQUNULEVBQUUsT0FBT1EsT0FBTztRQUNkVixRQUFRVSxLQUFLLENBQUNBO0lBQ2hCO0FBQ0YsR0FBRSIsInNvdXJjZXMiOlsid2VicGFjazovL3doaXNjaGF0Ly4vc3JjL3BhZ2VzL2FwaS9zZXJ2ZXIvaW5kZXgudHM/N2Q2ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvc2VydmVyLnRzXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgeyBTZXJ2ZXIsIFNvY2tldCB9IGZyb20gJ3NvY2tldC5pbyc7XG5pbXBvcnQgdHlwZSB7IFNlcnZlciBhcyBIVFRQU2VydmVyIH0gZnJvbSAnaHR0cCc7XG5pbXBvcnQgdHlwZSB7IFNvY2tldCBhcyBOZXRTb2NrZXQgfSBmcm9tICduZXQnO1xuXG5pbXBvcnQgKiBhcyBoYW5kbGVycyBmcm9tICdAL3NlcnZlci9oYW5kbGVycyc7XG5pbXBvcnQgZXhlY3V0ZUhhbmRsZXJzIGZyb20gJ0Avc2VydmVyL2hhbmRsZXJEZWNvcmF0b3InO1xuXG5pbXBvcnQgY29ubmVjdE1vbmdvIGZyb20gJ0Avc2VydmVyL3NlcnZpY2UvbW9uZ28nO1xuXG5pbnRlcmZhY2UgU29ja2V0U2VydmVyIGV4dGVuZHMgSFRUUFNlcnZlciB7XG4gIGlvPzogU2VydmVyIHwgdW5kZWZpbmVkO1xufVxuXG5pbnRlcmZhY2UgU29ja2V0V2l0aElPIGV4dGVuZHMgTmV0U29ja2V0IHtcbiAgc2VydmVyOiBTb2NrZXRTZXJ2ZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTmV4dEFwaVJlc3BvbnNlV2l0aFNvY2tldCBleHRlbmRzIE5leHRBcGlSZXNwb25zZSB7XG4gIHNvY2tldDogU29ja2V0V2l0aElPO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2VXaXRoU29ja2V0KSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKHJlcy5zb2NrZXQuc2VydmVyLmlvKSB7XG4gICAgICBjb25zb2xlLmxvZygnQWxyZWFkeSBzZXQgdXAnKTtcbiAgICAgIGF3YWl0IGNvbm5lY3RNb25nbygpO1xuICAgICAgcmVzLmVuZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGlvID0gbmV3IFNlcnZlcihyZXMuc29ja2V0LnNlcnZlciwge1xuICAgICAgY29yczogeyBvcmlnaW46ICcqJyB9LFxuICAgIH0pO1xuXG4gICAgYXdhaXQgY29ubmVjdE1vbmdvKCk7XG5cbiAgICAvLyBFdmVudCBoYW5kbGVyIGZvciBjbGllbnQgY29ubmVjdGlvbnNcbiAgICBpby5vbignY29ubmVjdGlvbicsIChzb2NrZXQ6IFNvY2tldCkgPT4ge1xuICAgICAgY29uc3QgY2xpZW50SWQgPSBzb2NrZXQuaWQ7XG4gICAgICBjb25zb2xlLmxvZyhgQSBjbGllbnQgY29ubmVjdGVkLiBJRDogJHtjbGllbnRJZH1gKTtcblxuICAgICAgZXhlY3V0ZUhhbmRsZXJzKGlvLCBzb2NrZXQsIE9iamVjdC52YWx1ZXMoaGFuZGxlcnMpKTtcblxuICAgICAgLy8gRXZlbnQgaGFuZGxlciBmb3IgY2xpZW50IGRpc2Nvbm5lY3Rpb25zXG4gICAgICBzb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdBIGNsaWVudCBkaXNjb25uZWN0ZWQuJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJlcy5zb2NrZXQuc2VydmVyLmlvID0gaW87XG4gICAgcmVzLmVuZCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbIlNlcnZlciIsImhhbmRsZXJzIiwiZXhlY3V0ZUhhbmRsZXJzIiwiY29ubmVjdE1vbmdvIiwicmVxIiwicmVzIiwic29ja2V0Iiwic2VydmVyIiwiaW8iLCJjb25zb2xlIiwibG9nIiwiZW5kIiwiY29ycyIsIm9yaWdpbiIsIm9uIiwiY2xpZW50SWQiLCJpZCIsIk9iamVjdCIsInZhbHVlcyIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/server/index.ts\n");

/***/ }),

/***/ "(api)/./src/server/handlerDecorator.ts":
/*!****************************************!*\
  !*** ./src/server/handlerDecorator.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst executeHandlers = (io, socket, handlers)=>{\n    handlers.forEach((handler)=>handler(io, socket));\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (executeHandlers);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmVyL2hhbmRsZXJEZWNvcmF0b3IudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUVBLE1BQU1BLGtCQUFrQixDQUFDQyxJQUFZQyxRQUFnQkM7SUFDbkRBLFNBQVNDLE9BQU8sQ0FBQyxDQUFDQyxVQUFpQkEsUUFBUUosSUFBSUM7QUFDakQ7QUFFQSxpRUFBZUYsZUFBZUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3doaXNjaGF0Ly4vc3JjL3NlcnZlci9oYW5kbGVyRGVjb3JhdG9yLnRzPzc0NjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU29ja2V0LCBTZXJ2ZXIgfSBmcm9tICdzb2NrZXQuaW8nO1xuXG5jb25zdCBleGVjdXRlSGFuZGxlcnMgPSAoaW86IFNlcnZlciwgc29ja2V0OiBTb2NrZXQsIGhhbmRsZXJzOiBhbnkpID0+IHtcbiAgaGFuZGxlcnMuZm9yRWFjaCgoaGFuZGxlcjogYW55KSA9PiBoYW5kbGVyKGlvLCBzb2NrZXQpKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGV4ZWN1dGVIYW5kbGVycztcbiJdLCJuYW1lcyI6WyJleGVjdXRlSGFuZGxlcnMiLCJpbyIsInNvY2tldCIsImhhbmRsZXJzIiwiZm9yRWFjaCIsImhhbmRsZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/server/handlerDecorator.ts\n");

/***/ }),

/***/ "(api)/./src/server/handlers.ts":
/*!********************************!*\
  !*** ./src/server/handlers.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CloseChatHandler: () => (/* binding */ CloseChatHandler),\n/* harmony export */   DeleteManagerHandler: () => (/* binding */ DeleteManagerHandler),\n/* harmony export */   EditMessageHandler: () => (/* binding */ EditMessageHandler),\n/* harmony export */   JoinHandler: () => (/* binding */ JoinHandler),\n/* harmony export */   LogOutHandler: () => (/* binding */ LogOutHandler),\n/* harmony export */   OnlineStatusHandler: () => (/* binding */ OnlineStatusHandler),\n/* harmony export */   SeenMessageHandler: () => (/* binding */ SeenMessageHandler),\n/* harmony export */   SendMessageHandler: () => (/* binding */ SendMessageHandler),\n/* harmony export */   StopSearchHandler: () => (/* binding */ StopSearchHandler),\n/* harmony export */   TypingHandler: () => (/* binding */ TypingHandler)\n/* harmony export */ });\n/* harmony import */ var _shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/shared/constants/constants */ \"(api)/./src/shared/constants/constants.ts\");\n/* harmony import */ var _server_lib_lib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/lib/lib */ \"(api)/./src/server/lib/lib.ts\");\n\n\nconst CloseChatHandler = (socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_CLOSE, async (roomId, setChatClosed)=>{\n        const user = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getActiveUser)({\n            socketId: socket.id\n        });\n        if (!user || !(0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.chatExists)(roomId)) {\n            setChatClosed(false);\n            return;\n        }\n        const inactiveList = await (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.closeChat)(roomId);\n        setChatClosed(true);\n        socket.broadcast.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_CLOSE, roomId);\n        inactiveList?.forEach((loginId)=>{\n            socket.broadcast.to(loginId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_INACTIVE);\n        });\n    });\n};\nconst DeleteManagerHandler = (socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_DELETE_MESSAGE, async ({ id: messageId, roomId }, messageWasDeletedSuccessfully)=>{\n        const user = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getActiveUser)({\n            socketId: socket.id\n        });\n        if (!user || !messageId || !roomId) {\n            messageWasDeletedSuccessfully(false);\n            return;\n        }\n        const messageDeleted = await (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.removeMessage)(roomId, messageId);\n        socket.broadcast.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_DELETE_MESSAGE, {\n            id: messageId,\n            roomId\n        });\n        messageWasDeletedSuccessfully(messageDeleted);\n    });\n};\nconst EditMessageHandler = (socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_EDIT_MESSAGE, async ({ id: messageId, roomId, newMessage, oldMessage }, messageWasEditedSuccessfully)=>{\n        const user = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getActiveUser)({\n            socketId: socket.id\n        });\n        if (!user || !messageId || !roomId) {\n            messageWasEditedSuccessfully(false);\n            return;\n        }\n        const messageEdited = await (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.editMessage)(roomId, {\n            id: messageId,\n            message: newMessage,\n            oldMessage\n        });\n        socket.broadcast.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_EDIT_MESSAGE, messageEdited);\n        messageWasEditedSuccessfully(messageEdited);\n    });\n};\n/**\n * this function will be triggred when ever the user from front-end will search\n * for new user to chat.\n */ const matchMaker = async (io)=>{\n    while((0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getWaitingUserLen)() > 1){\n        const chat = await (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.createChat)((0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getRandomPairFromWaitingList)());\n        const roomId = chat.id;\n        io.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_JOINED, {\n            roomId: chat.id,\n            userIds: chat.userIds\n        });\n    }\n};\nconst JoinHandler = (io, socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_JOIN, ({ loginId, email })=>{\n        /**\n     * This is necessary to enable us send notifications to users\n     * using multiple devices to chat\n     */ socket.join(loginId);\n        /**\n     * First we check if the user is already chatting.\n     * If the user is already chatting, continue the chat from where the user left\n     */ if ((0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.isUserActive)(loginId)) {\n            const user = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getActiveUser)({\n                socketId: socket.id,\n                loginId,\n                email: email ?? null\n            });\n            // First join the user to the last chat\n            if (!user?.socketIds.includes(socket.id)) {\n                socket.join(user?.currentRoomId);\n                user?.socketConnections.push(socket);\n                user?.socketIds.push(socket.id);\n            }\n            const chats = {};\n            user?.rooms.forEach((roomId)=>{\n                chats[roomId] = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getChat)(roomId);\n            });\n            // Then return all chat messages\n            socket.emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_CHAT_RESTORE, {\n                chats,\n                currentRoomId: user?.currentRoomId\n            });\n            return;\n        }\n        // The user was not having any previous chat. So add to the waiting list\n        (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.addToWaitingList)({\n            loginId,\n            email,\n            socket\n        });\n        // Finally, run matchMaker to pair all users on the waiting list\n        matchMaker(io);\n    });\n};\nconst LogOutHandler = (io, socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_LOGOUT, async ({ loginId, email })=>{\n        const user = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getActiveUser)({\n            socketId: socket.id\n        });\n        (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.delWaitingUser)(email ?? loginId);\n        if (!user) {\n            return;\n        }\n        // User is an anonymous user, so close all active chats\n        if (!user.email) {\n            for (const roomId of user.rooms){\n                const inactiveList = await (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.closeChat)(roomId);\n                io.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_CLOSE, roomId);\n                inactiveList?.forEach((emailOrLoginId)=>{\n                    socket.broadcast.to(emailOrLoginId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_INACTIVE);\n                });\n            }\n        }\n    });\n};\nconst OnlineStatusHandler = (socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_ONLINE_STATUS, ({ onlineStatus, roomId })=>{\n        socket.broadcast.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_ONLINE_STATUS, onlineStatus);\n    });\n};\nconst SeenMessageHandler = (socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_READ_MESSAGE, async ({ messageId, roomId }, messageSuccessfullySeen)=>{\n        const user = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getActiveUser)({\n            socketId: socket.id\n        });\n        if (!user || !messageId || !roomId) {\n            messageSuccessfullySeen(false);\n            return;\n        }\n        const messageSeen = await (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.seenMessage)(roomId, messageId);\n        socket.broadcast.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_READ_MESSAGE, {\n            messageId,\n            roomId\n        });\n        messageSuccessfullySeen(messageSeen);\n    });\n};\nconst messageCounts = {};\nconst SendMessageHandler = (io, socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_SEND_MESSAGE, async ({ senderId, message, time, roomId: roomId, containsBadword, replyTo }, returnMessageToSender)=>{\n        // Below line is just a failed message simulator for testing purposes.\n        // export const rndInt = Math.floor(Math.random() * 6) + 1;\n        // if (rndInt % 2 !== 0) {\n        //   return;\n        // }\n        const user = (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.getActiveUser)({\n            socketId: socket.id\n        });\n        if (!user) {\n            socket.emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_SEND_FAILED, {\n                message: \"Hmmm. It seems your login session has expired. \" + \"Re-login and try again\"\n            });\n            return;\n        }\n        // Check the message count for the user\n        const userMessageCount = messageCounts[senderId] || 0;\n        if (userMessageCount >= 25) {\n            // User has exceeded the message limit\n            socket.emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_SEND_FAILED, {\n                message: \"You have exceeded the message limit. Please try again later.\"\n            });\n            return;\n        }\n        /**\n       * Cache the sent message in memory a nd persist to db\n       */ const sentMessage = await (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.addMessage)(roomId, {\n            message,\n            time,\n            senderId,\n            type: \"message\",\n            containsBadword,\n            replyTo\n        });\n        const messageDetails = {\n            ...sentMessage,\n            roomId,\n            status: \"sent\"\n        };\n        returnMessageToSender(messageDetails);\n        socket.broadcast.to(roomId).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_RECEIVE_MESSAGE, messageDetails);\n        // Update the message count for the user\n        messageCounts[senderId] = userMessageCount + 1;\n        // Reset the count after 1 minute\n        setTimeout(()=>{\n            messageCounts[senderId] = 0;\n        }, 60 * 1000);\n    });\n};\nconst StopSearchHandler = (socket)=>{\n    try {\n        socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_STOP_SEARCH, async ({ loginId })=>{\n            (0,_server_lib_lib__WEBPACK_IMPORTED_MODULE_1__.delWaitingUser)(loginId);\n            socket.emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_STOP_SEARCH_SUCCESS);\n        });\n    } catch (err) {\n        console.error(err);\n    }\n};\nconst TypingHandler = (socket)=>{\n    socket.on(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_TYPING, ({ roomId, isTyping })=>{\n        socket.to(roomId).timeout(5000).emit(_shared_constants_constants__WEBPACK_IMPORTED_MODULE_0__[\"default\"].NEW_EVENT_DISPLAY, {\n            isTyping,\n            roomId\n        });\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1lBQzNEakIsK0RBQWNBLENBQUNpQjtZQUNmYixPQUFPVyxJQUFJLENBQUMzQixpR0FBdUM7UUFDckQ7SUFDRixFQUFFLE9BQU95RixLQUFLO1FBQ1pDLFFBQVFDLEtBQUssQ0FBQ0Y7SUFDaEI7QUFDRixFQUFFO0FBRUssTUFBTUcsZ0JBQWdCLENBQUM1RTtJQUM1QkEsT0FBT0MsRUFBRSxDQUFDakIsb0ZBQTBCLEVBQUUsQ0FBQyxFQUFFbUIsTUFBTSxFQUFFMkUsUUFBUSxFQUFFO1FBQ3pEOUUsT0FDR1UsRUFBRSxDQUFDUCxRQUNINEUsT0FBTyxDQUFDLE1BQ1JwRSxJQUFJLENBQUMzQixxRkFBMkIsRUFBRTtZQUFFOEY7WUFBVTNFO1FBQU87SUFDMUQ7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2hpc2NoYXQvLi9zcmMvc2VydmVyL2hhbmRsZXJzLnRzPzk2NzEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VydmVyLCBTb2NrZXQgfSBmcm9tICdzb2NrZXQuaW8nO1xuXG5pbXBvcnQgY29uc3RhbnRzIGZyb20gJ0Avc2hhcmVkL2NvbnN0YW50cy9jb25zdGFudHMnO1xuaW1wb3J0IHsgUm9vbVR5cGUsIE9ubGluZVN0YXR1cyB9IGZyb20gJ0AvdHlwZXMvdHlwZXMnO1xuaW1wb3J0IHtcbiAgY2hhdEV4aXN0cyxcbiAgY2xvc2VDaGF0LFxuICByZW1vdmVNZXNzYWdlLFxuICBlZGl0TWVzc2FnZSxcbiAgaXNVc2VyQWN0aXZlLFxuICBhZGRUb1dhaXRpbmdMaXN0LFxuICBnZXRDaGF0LFxuICBnZXRXYWl0aW5nVXNlckxlbixcbiAgZ2V0UmFuZG9tUGFpckZyb21XYWl0aW5nTGlzdCxcbiAgY3JlYXRlQ2hhdCxcbiAgZ2V0QWN0aXZlVXNlcixcbiAgZGVsV2FpdGluZ1VzZXIsXG4gIHNlZW5NZXNzYWdlLFxuICBhZGRNZXNzYWdlLFxufSBmcm9tICdAL3NlcnZlci9saWIvbGliJztcblxuZXhwb3J0IGNvbnN0IENsb3NlQ2hhdEhhbmRsZXIgPSAoc29ja2V0OiBTb2NrZXQpID0+IHtcbiAgc29ja2V0Lm9uKFxuICAgIGNvbnN0YW50cy5ORVdfRVZFTlRfQ0xPU0UsXG4gICAgYXN5bmMgKFxuICAgICAgcm9vbUlkOiBzdHJpbmcgfCBzdHJpbmdbXSxcbiAgICAgIHNldENoYXRDbG9zZWQ6IChhcmcwOiBib29sZWFuKSA9PiB2b2lkXG4gICAgKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0gZ2V0QWN0aXZlVXNlcih7XG4gICAgICAgIHNvY2tldElkOiBzb2NrZXQuaWQsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCF1c2VyIHx8ICFjaGF0RXhpc3RzKHJvb21JZCBhcyBzdHJpbmcpKSB7XG4gICAgICAgIHNldENoYXRDbG9zZWQoZmFsc2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGluYWN0aXZlTGlzdCA9IGF3YWl0IGNsb3NlQ2hhdChyb29tSWQgYXMgc3RyaW5nKTtcblxuICAgICAgc2V0Q2hhdENsb3NlZCh0cnVlKTtcbiAgICAgIHNvY2tldC5icm9hZGNhc3QudG8ocm9vbUlkKS5lbWl0KGNvbnN0YW50cy5ORVdfRVZFTlRfQ0xPU0UsIHJvb21JZCk7XG4gICAgICBpbmFjdGl2ZUxpc3Q/LmZvckVhY2goKGxvZ2luSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBzb2NrZXQuYnJvYWRjYXN0LnRvKGxvZ2luSWQpLmVtaXQoY29uc3RhbnRzLk5FV19FVkVOVF9JTkFDVElWRSk7XG4gICAgICB9KTtcbiAgICB9XG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgRGVsZXRlTWFuYWdlckhhbmRsZXIgPSAoc29ja2V0OiBTb2NrZXQpID0+IHtcbiAgc29ja2V0Lm9uKFxuICAgIGNvbnN0YW50cy5ORVdfRVZFTlRfREVMRVRFX01FU1NBR0UsXG4gICAgYXN5bmMgKHsgaWQ6IG1lc3NhZ2VJZCwgcm9vbUlkIH0sIG1lc3NhZ2VXYXNEZWxldGVkU3VjY2Vzc2Z1bGx5KSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0gZ2V0QWN0aXZlVXNlcih7XG4gICAgICAgIHNvY2tldElkOiBzb2NrZXQuaWQsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCF1c2VyIHx8ICFtZXNzYWdlSWQgfHwgIXJvb21JZCkge1xuICAgICAgICBtZXNzYWdlV2FzRGVsZXRlZFN1Y2Nlc3NmdWxseShmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbWVzc2FnZURlbGV0ZWQgPSBhd2FpdCByZW1vdmVNZXNzYWdlKHJvb21JZCwgbWVzc2FnZUlkKTtcblxuICAgICAgc29ja2V0LmJyb2FkY2FzdFxuICAgICAgICAudG8ocm9vbUlkKVxuICAgICAgICAuZW1pdChjb25zdGFudHMuTkVXX0VWRU5UX0RFTEVURV9NRVNTQUdFLCB7IGlkOiBtZXNzYWdlSWQsIHJvb21JZCB9KTtcbiAgICAgIG1lc3NhZ2VXYXNEZWxldGVkU3VjY2Vzc2Z1bGx5KG1lc3NhZ2VEZWxldGVkKTtcbiAgICB9XG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgRWRpdE1lc3NhZ2VIYW5kbGVyID0gKHNvY2tldDogU29ja2V0KSA9PiB7XG4gIHNvY2tldC5vbihcbiAgICBjb25zdGFudHMuTkVXX0VWRU5UX0VESVRfTUVTU0FHRSxcbiAgICBhc3luYyAoXG4gICAgICB7IGlkOiBtZXNzYWdlSWQsIHJvb21JZCwgbmV3TWVzc2FnZSwgb2xkTWVzc2FnZSB9LFxuICAgICAgbWVzc2FnZVdhc0VkaXRlZFN1Y2Nlc3NmdWxseVxuICAgICkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IGdldEFjdGl2ZVVzZXIoe1xuICAgICAgICBzb2NrZXRJZDogc29ja2V0LmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghdXNlciB8fCAhbWVzc2FnZUlkIHx8ICFyb29tSWQpIHtcbiAgICAgICAgbWVzc2FnZVdhc0VkaXRlZFN1Y2Nlc3NmdWxseShmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbWVzc2FnZUVkaXRlZCA9IGF3YWl0IGVkaXRNZXNzYWdlKHJvb21JZCwge1xuICAgICAgICBpZDogbWVzc2FnZUlkLFxuICAgICAgICBtZXNzYWdlOiBuZXdNZXNzYWdlLFxuICAgICAgICBvbGRNZXNzYWdlLFxuICAgICAgfSk7XG4gICAgICBzb2NrZXQuYnJvYWRjYXN0XG4gICAgICAgIC50byhyb29tSWQpXG4gICAgICAgIC5lbWl0KGNvbnN0YW50cy5ORVdfRVZFTlRfRURJVF9NRVNTQUdFLCBtZXNzYWdlRWRpdGVkKTtcbiAgICAgIG1lc3NhZ2VXYXNFZGl0ZWRTdWNjZXNzZnVsbHkobWVzc2FnZUVkaXRlZCk7XG4gICAgfVxuICApO1xufTtcblxuLyoqXG4gKiB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgdHJpZ2dyZWQgd2hlbiBldmVyIHRoZSB1c2VyIGZyb20gZnJvbnQtZW5kIHdpbGwgc2VhcmNoXG4gKiBmb3IgbmV3IHVzZXIgdG8gY2hhdC5cbiAqL1xuY29uc3QgbWF0Y2hNYWtlciA9IGFzeW5jIChpbzogU2VydmVyKSA9PiB7XG4gIHdoaWxlIChnZXRXYWl0aW5nVXNlckxlbigpID4gMSkge1xuICAgIGNvbnN0IGNoYXQgPSBhd2FpdCBjcmVhdGVDaGF0KGdldFJhbmRvbVBhaXJGcm9tV2FpdGluZ0xpc3QoKSk7XG4gICAgY29uc3Qgcm9vbUlkOiBzdHJpbmcgPSBjaGF0LmlkIGFzIHVua25vd24gYXMgc3RyaW5nO1xuICAgIGlvLnRvKHJvb21JZCkuZW1pdChjb25zdGFudHMuTkVXX0VWRU5UX0pPSU5FRCwge1xuICAgICAgcm9vbUlkOiBjaGF0LmlkLFxuICAgICAgdXNlcklkczogY2hhdC51c2VySWRzLFxuICAgIH0pO1xuICB9XG59O1xuZXhwb3J0IGNvbnN0IEpvaW5IYW5kbGVyID0gKGlvOiBTZXJ2ZXIsIHNvY2tldDogU29ja2V0KSA9PiB7XG4gIHNvY2tldC5vbihjb25zdGFudHMuTkVXX0VWRU5UX0pPSU4sICh7IGxvZ2luSWQsIGVtYWlsIH0pID0+IHtcbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIG5lY2Vzc2FyeSB0byBlbmFibGUgdXMgc2VuZCBub3RpZmljYXRpb25zIHRvIHVzZXJzXG4gICAgICogdXNpbmcgbXVsdGlwbGUgZGV2aWNlcyB0byBjaGF0XG4gICAgICovXG4gICAgc29ja2V0LmpvaW4obG9naW5JZCk7XG5cbiAgICAvKipcbiAgICAgKiBGaXJzdCB3ZSBjaGVjayBpZiB0aGUgdXNlciBpcyBhbHJlYWR5IGNoYXR0aW5nLlxuICAgICAqIElmIHRoZSB1c2VyIGlzIGFscmVhZHkgY2hhdHRpbmcsIGNvbnRpbnVlIHRoZSBjaGF0IGZyb20gd2hlcmUgdGhlIHVzZXIgbGVmdFxuICAgICAqL1xuICAgIGlmIChpc1VzZXJBY3RpdmUobG9naW5JZCkpIHtcbiAgICAgIGNvbnN0IHVzZXIgPSBnZXRBY3RpdmVVc2VyKHtcbiAgICAgICAgc29ja2V0SWQ6IHNvY2tldC5pZCxcbiAgICAgICAgbG9naW5JZCxcbiAgICAgICAgZW1haWw6IGVtYWlsID8/IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgLy8gRmlyc3Qgam9pbiB0aGUgdXNlciB0byB0aGUgbGFzdCBjaGF0XG4gICAgICBpZiAoIXVzZXI/LnNvY2tldElkcy5pbmNsdWRlcyhzb2NrZXQuaWQpKSB7XG4gICAgICAgIHNvY2tldC5qb2luKHVzZXI/LmN1cnJlbnRSb29tSWQgYXMgc3RyaW5nKTtcbiAgICAgICAgdXNlcj8uc29ja2V0Q29ubmVjdGlvbnMucHVzaChzb2NrZXQpO1xuICAgICAgICB1c2VyPy5zb2NrZXRJZHMucHVzaChzb2NrZXQuaWQpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjaGF0czogUm9vbVR5cGUgPSB7fTtcblxuICAgICAgdXNlcj8ucm9vbXMuZm9yRWFjaChyb29tSWQgPT4ge1xuICAgICAgICBjaGF0c1tyb29tSWRdID0gZ2V0Q2hhdChyb29tSWQpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFRoZW4gcmV0dXJuIGFsbCBjaGF0IG1lc3NhZ2VzXG4gICAgICBzb2NrZXQuZW1pdChjb25zdGFudHMuTkVXX0VWRU5UX0NIQVRfUkVTVE9SRSwge1xuICAgICAgICBjaGF0cyxcbiAgICAgICAgY3VycmVudFJvb21JZDogdXNlcj8uY3VycmVudFJvb21JZCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBUaGUgdXNlciB3YXMgbm90IGhhdmluZyBhbnkgcHJldmlvdXMgY2hhdC4gU28gYWRkIHRvIHRoZSB3YWl0aW5nIGxpc3RcbiAgICBhZGRUb1dhaXRpbmdMaXN0KHsgbG9naW5JZCwgZW1haWwsIHNvY2tldCB9KTtcblxuICAgIC8vIEZpbmFsbHksIHJ1biBtYXRjaE1ha2VyIHRvIHBhaXIgYWxsIHVzZXJzIG9uIHRoZSB3YWl0aW5nIGxpc3RcbiAgICBtYXRjaE1ha2VyKGlvKTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgTG9nT3V0SGFuZGxlciA9IChpbzogU2VydmVyLCBzb2NrZXQ6IFNvY2tldCkgPT4ge1xuICBzb2NrZXQub24oY29uc3RhbnRzLk5FV19FVkVOVF9MT0dPVVQsIGFzeW5jICh7IGxvZ2luSWQsIGVtYWlsIH0pID0+IHtcbiAgICBjb25zdCB1c2VyID0gZ2V0QWN0aXZlVXNlcih7XG4gICAgICBzb2NrZXRJZDogc29ja2V0LmlkLFxuICAgIH0pO1xuXG4gICAgZGVsV2FpdGluZ1VzZXIoZW1haWwgPz8gbG9naW5JZCk7XG5cbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBVc2VyIGlzIGFuIGFub255bW91cyB1c2VyLCBzbyBjbG9zZSBhbGwgYWN0aXZlIGNoYXRzXG4gICAgaWYgKCF1c2VyLmVtYWlsKSB7XG4gICAgICBmb3IgKGNvbnN0IHJvb21JZCBvZiB1c2VyLnJvb21zKSB7XG4gICAgICAgIGNvbnN0IGluYWN0aXZlTGlzdCA9IGF3YWl0IGNsb3NlQ2hhdChyb29tSWQpO1xuICAgICAgICBpby50byhyb29tSWQpLmVtaXQoY29uc3RhbnRzLk5FV19FVkVOVF9DTE9TRSwgcm9vbUlkKTtcbiAgICAgICAgaW5hY3RpdmVMaXN0Py5mb3JFYWNoKGVtYWlsT3JMb2dpbklkID0+IHtcbiAgICAgICAgICBzb2NrZXQuYnJvYWRjYXN0XG4gICAgICAgICAgICAudG8oZW1haWxPckxvZ2luSWQpXG4gICAgICAgICAgICAuZW1pdChjb25zdGFudHMuTkVXX0VWRU5UX0lOQUNUSVZFKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBPbmxpbmVTdGF0dXNIYW5kbGVyID0gKHNvY2tldDogU29ja2V0KSA9PiB7XG4gIHNvY2tldC5vbihcbiAgICBjb25zdGFudHMuTkVXX0VWRU5UX09OTElORV9TVEFUVVMsXG4gICAgKHtcbiAgICAgIG9ubGluZVN0YXR1cyxcbiAgICAgIHJvb21JZCxcbiAgICB9OiB7XG4gICAgICBvbmxpbmVTdGF0dXM6IE9ubGluZVN0YXR1cztcbiAgICAgIHJvb21JZDogc3RyaW5nO1xuICAgIH0pOiB2b2lkID0+IHtcbiAgICAgIHNvY2tldC5icm9hZGNhc3RcbiAgICAgICAgLnRvKHJvb21JZClcbiAgICAgICAgLmVtaXQoY29uc3RhbnRzLk5FV19FVkVOVF9PTkxJTkVfU1RBVFVTLCBvbmxpbmVTdGF0dXMpO1xuICAgIH1cbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBTZWVuTWVzc2FnZUhhbmRsZXIgPSAoc29ja2V0OiBTb2NrZXQpID0+IHtcbiAgc29ja2V0Lm9uKFxuICAgIGNvbnN0YW50cy5ORVdfRVZFTlRfUkVBRF9NRVNTQUdFLFxuICAgIGFzeW5jICh7IG1lc3NhZ2VJZCwgcm9vbUlkIH0sIG1lc3NhZ2VTdWNjZXNzZnVsbHlTZWVuKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0gZ2V0QWN0aXZlVXNlcih7IHNvY2tldElkOiBzb2NrZXQuaWQgfSk7XG5cbiAgICAgIGlmICghdXNlciB8fCAhbWVzc2FnZUlkIHx8ICFyb29tSWQpIHtcbiAgICAgICAgbWVzc2FnZVN1Y2Nlc3NmdWxseVNlZW4oZmFsc2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2VTZWVuID0gYXdhaXQgc2Vlbk1lc3NhZ2Uocm9vbUlkLCBtZXNzYWdlSWQpO1xuXG4gICAgICBzb2NrZXQuYnJvYWRjYXN0LnRvKHJvb21JZCkuZW1pdChjb25zdGFudHMuTkVXX0VWRU5UX1JFQURfTUVTU0FHRSwge1xuICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgIHJvb21JZCxcbiAgICAgIH0pO1xuXG4gICAgICBtZXNzYWdlU3VjY2Vzc2Z1bGx5U2VlbihtZXNzYWdlU2Vlbik7XG4gICAgfVxuICApO1xufTtcblxuY29uc3QgbWVzc2FnZUNvdW50czoge1xuICBbaWQ6IHN0cmluZ106IG51bWJlcjtcbn0gPSB7fTtcblxuZXhwb3J0IGNvbnN0IFNlbmRNZXNzYWdlSGFuZGxlciA9IChpbzogU2VydmVyLCBzb2NrZXQ6IFNvY2tldCkgPT4ge1xuICBzb2NrZXQub24oXG4gICAgY29uc3RhbnRzLk5FV19FVkVOVF9TRU5EX01FU1NBR0UsXG4gICAgYXN5bmMgKFxuICAgICAgeyBzZW5kZXJJZCwgbWVzc2FnZSwgdGltZSwgcm9vbUlkOiByb29tSWQsIGNvbnRhaW5zQmFkd29yZCwgcmVwbHlUbyB9LFxuICAgICAgcmV0dXJuTWVzc2FnZVRvU2VuZGVyXG4gICAgKSA9PiB7XG4gICAgICAvLyBCZWxvdyBsaW5lIGlzIGp1c3QgYSBmYWlsZWQgbWVzc2FnZSBzaW11bGF0b3IgZm9yIHRlc3RpbmcgcHVycG9zZXMuXG5cbiAgICAgIC8vIGV4cG9ydCBjb25zdCBybmRJbnQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2KSArIDE7XG4gICAgICAvLyBpZiAocm5kSW50ICUgMiAhPT0gMCkge1xuICAgICAgLy8gICByZXR1cm47XG4gICAgICAvLyB9XG4gICAgICBjb25zdCB1c2VyID0gZ2V0QWN0aXZlVXNlcih7XG4gICAgICAgIHNvY2tldElkOiBzb2NrZXQuaWQsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHNvY2tldC5lbWl0KGNvbnN0YW50cy5ORVdfRVZFTlRfU0VORF9GQUlMRUQsIHtcbiAgICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICAgJ0htbW0uIEl0IHNlZW1zIHlvdXIgbG9naW4gc2Vzc2lvbiBoYXMgZXhwaXJlZC4gJyArXG4gICAgICAgICAgICAnUmUtbG9naW4gYW5kIHRyeSBhZ2FpbicsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHRoZSBtZXNzYWdlIGNvdW50IGZvciB0aGUgdXNlclxuICAgICAgY29uc3QgdXNlck1lc3NhZ2VDb3VudCA9IG1lc3NhZ2VDb3VudHNbc2VuZGVySWRdIHx8IDA7XG5cbiAgICAgIGlmICh1c2VyTWVzc2FnZUNvdW50ID49IDI1KSB7XG4gICAgICAgIC8vIFVzZXIgaGFzIGV4Y2VlZGVkIHRoZSBtZXNzYWdlIGxpbWl0XG4gICAgICAgIHNvY2tldC5lbWl0KGNvbnN0YW50cy5ORVdfRVZFTlRfU0VORF9GQUlMRUQsIHtcbiAgICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICAgJ1lvdSBoYXZlIGV4Y2VlZGVkIHRoZSBtZXNzYWdlIGxpbWl0LiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogQ2FjaGUgdGhlIHNlbnQgbWVzc2FnZSBpbiBtZW1vcnkgYSBuZCBwZXJzaXN0IHRvIGRiXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IHNlbnRNZXNzYWdlID0gYXdhaXQgYWRkTWVzc2FnZShyb29tSWQsIHtcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgdGltZSxcbiAgICAgICAgc2VuZGVySWQsXG4gICAgICAgIHR5cGU6ICdtZXNzYWdlJyxcbiAgICAgICAgY29udGFpbnNCYWR3b3JkLFxuICAgICAgICByZXBseVRvLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2VEZXRhaWxzID0ge1xuICAgICAgICAuLi5zZW50TWVzc2FnZSxcbiAgICAgICAgcm9vbUlkLFxuICAgICAgICBzdGF0dXM6ICdzZW50JyxcbiAgICAgIH07XG5cbiAgICAgIHJldHVybk1lc3NhZ2VUb1NlbmRlcihtZXNzYWdlRGV0YWlscyk7XG5cbiAgICAgIHNvY2tldC5icm9hZGNhc3RcbiAgICAgICAgLnRvKHJvb21JZClcbiAgICAgICAgLmVtaXQoY29uc3RhbnRzLk5FV19FVkVOVF9SRUNFSVZFX01FU1NBR0UsIG1lc3NhZ2VEZXRhaWxzKTtcblxuICAgICAgLy8gVXBkYXRlIHRoZSBtZXNzYWdlIGNvdW50IGZvciB0aGUgdXNlclxuICAgICAgbWVzc2FnZUNvdW50c1tzZW5kZXJJZF0gPSB1c2VyTWVzc2FnZUNvdW50ICsgMTtcblxuICAgICAgLy8gUmVzZXQgdGhlIGNvdW50IGFmdGVyIDEgbWludXRlXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgbWVzc2FnZUNvdW50c1tzZW5kZXJJZF0gPSAwO1xuICAgICAgfSwgNjAgKiAxMDAwKTtcbiAgICB9XG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgU3RvcFNlYXJjaEhhbmRsZXIgPSAoc29ja2V0OiBTb2NrZXQpID0+IHtcbiAgdHJ5IHtcbiAgICBzb2NrZXQub24oY29uc3RhbnRzLk5FV19FVkVOVF9TVE9QX1NFQVJDSCwgYXN5bmMgKHsgbG9naW5JZCB9KSA9PiB7XG4gICAgICBkZWxXYWl0aW5nVXNlcihsb2dpbklkKTtcbiAgICAgIHNvY2tldC5lbWl0KGNvbnN0YW50cy5ORVdfRVZFTlRfU1RPUF9TRUFSQ0hfU1VDQ0VTUyk7XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IFR5cGluZ0hhbmRsZXIgPSAoc29ja2V0OiBTb2NrZXQpID0+IHtcbiAgc29ja2V0Lm9uKGNvbnN0YW50cy5ORVdfRVZFTlRfVFlQSU5HLCAoeyByb29tSWQsIGlzVHlwaW5nIH0pID0+IHtcbiAgICBzb2NrZXRcbiAgICAgIC50byhyb29tSWQpXG4gICAgICAudGltZW91dCg1MDAwKVxuICAgICAgLmVtaXQoY29uc3RhbnRzLk5FV19FVkVOVF9ESVNQTEFZLCB7IGlzVHlwaW5nLCByb29tSWQgfSk7XG4gIH0pO1xufTtcbiJdLCJuYW1lcyI6WyJjb25zdGFudHMiLCJjaGF0RXhpc3RzIiwiY2xvc2VDaGF0IiwicmVtb3ZlTWVzc2FnZSIsImVkaXRNZXNzYWdlIiwiaXNVc2VyQWN0aXZlIiwiYWRkVG9XYWl0aW5nTGlzdCIsImdldENoYXQiLCJnZXRXYWl0aW5nVXNlckxlbiIsImdldFJhbmRvbVBhaXJGcm9tV2FpdGluZ0xpc3QiLCJjcmVhdGVDaGF0IiwiZ2V0QWN0aXZlVXNlciIsImRlbFdhaXRpbmdVc2VyIiwic2Vlbk1lc3NhZ2UiLCJhZGRNZXNzYWdlIiwiQ2xvc2VDaGF0SGFuZGxlciIsInNvY2tldCIsIm9uIiwiTkVXX0VWRU5UX0NMT1NFIiwicm9vbUlkIiwic2V0Q2hhdENsb3NlZCIsInVzZXIiLCJzb2NrZXRJZCIsImlkIiwiaW5hY3RpdmVMaXN0IiwiYnJvYWRjYXN0IiwidG8iLCJlbWl0IiwiZm9yRWFjaCIsImxvZ2luSWQiLCJORVdfRVZFTlRfSU5BQ1RJVkUiLCJEZWxldGVNYW5hZ2VySGFuZGxlciIsIk5FV19FVkVOVF9ERUxFVEVfTUVTU0FHRSIsIm1lc3NhZ2VJZCIsIm1lc3NhZ2VXYXNEZWxldGVkU3VjY2Vzc2Z1bGx5IiwibWVzc2FnZURlbGV0ZWQiLCJFZGl0TWVzc2FnZUhhbmRsZXIiLCJORVdfRVZFTlRfRURJVF9NRVNTQUdFIiwibmV3TWVzc2FnZSIsIm9sZE1lc3NhZ2UiLCJtZXNzYWdlV2FzRWRpdGVkU3VjY2Vzc2Z1bGx5IiwibWVzc2FnZUVkaXRlZCIsIm1lc3NhZ2UiLCJtYXRjaE1ha2VyIiwiaW8iLCJjaGF0IiwiTkVXX0VWRU5UX0pPSU5FRCIsInVzZXJJZHMiLCJKb2luSGFuZGxlciIsIk5FV19FVkVOVF9KT0lOIiwiZW1haWwiLCJqb2luIiwic29ja2V0SWRzIiwiaW5jbHVkZXMiLCJjdXJyZW50Um9vbUlkIiwic29ja2V0Q29ubmVjdGlvbnMiLCJwdXNoIiwiY2hhdHMiLCJyb29tcyIsIk5FV19FVkVOVF9DSEFUX1JFU1RPUkUiLCJMb2dPdXRIYW5kbGVyIiwiTkVXX0VWRU5UX0xPR09VVCIsImVtYWlsT3JMb2dpbklkIiwiT25saW5lU3RhdHVzSGFuZGxlciIsIk5FV19FVkVOVF9PTkxJTkVfU1RBVFVTIiwib25saW5lU3RhdHVzIiwiU2Vlbk1lc3NhZ2VIYW5kbGVyIiwiTkVXX0VWRU5UX1JFQURfTUVTU0FHRSIsIm1lc3NhZ2VTdWNjZXNzZnVsbHlTZWVuIiwibWVzc2FnZVNlZW4iLCJtZXNzYWdlQ291bnRzIiwiU2VuZE1lc3NhZ2VIYW5kbGVyIiwiTkVXX0VWRU5UX1NFTkRfTUVTU0FHRSIsInNlbmRlcklkIiwidGltZSIsImNvbnRhaW5zQmFkd29yZCIsInJlcGx5VG8iLCJyZXR1cm5NZXNzYWdlVG9TZW5kZXIiLCJORVdfRVZFTlRfU0VORF9GQUlMRUQiLCJ1c2VyTWVzc2FnZUNvdW50Iiwic2VudE1lc3NhZ2UiLCJ0eXBlIiwibWVzc2FnZURldGFpbHMiLCJzdGF0dXMiLCJORVdfRVZFTlRfUkVDRUlWRV9NRVNTQUdFIiwic2V0VGltZW91dCIsIlN0b3BTZWFyY2hIYW5kbGVyIiwiTkVXX0VWRU5UX1NUT1BfU0VBUkNIIiwiTkVXX0VWRU5UX1NUT1BfU0VBUkNIX1NVQ0NFU1MiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJUeXBpbmdIYW5kbGVyIiwiTkVXX0VWRU5UX1RZUElORyIsImlzVHlwaW5nIiwidGltZW91dCIsIk5FV19FVkVOVF9ESVNQTEFZIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/server/handlers.ts\n");

/***/ }),

/***/ "(api)/./src/server/lib/lib.ts":
/*!*******************************!*\
  !*** ./src/server/lib/lib.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addMessage: () => (/* binding */ addMessage),\n/* harmony export */   addToWaitingList: () => (/* binding */ addToWaitingList),\n/* harmony export */   chatExists: () => (/* binding */ chatExists),\n/* harmony export */   closeChat: () => (/* binding */ closeChat),\n/* harmony export */   createChat: () => (/* binding */ createChat),\n/* harmony export */   delWaitingUser: () => (/* binding */ delWaitingUser),\n/* harmony export */   editMessage: () => (/* binding */ editMessage),\n/* harmony export */   getActiveUser: () => (/* binding */ getActiveUser),\n/* harmony export */   getChat: () => (/* binding */ getChat),\n/* harmony export */   getRandomPairFromWaitingList: () => (/* binding */ getRandomPairFromWaitingList),\n/* harmony export */   getWaitingUserLen: () => (/* binding */ getWaitingUserLen),\n/* harmony export */   init: () => (/* binding */ init),\n/* harmony export */   isUserActive: () => (/* binding */ isUserActive),\n/* harmony export */   removeMessage: () => (/* binding */ removeMessage),\n/* harmony export */   seenMessage: () => (/* binding */ seenMessage)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var crypto_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto-js */ \"crypto-js\");\n/* harmony import */ var crypto_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _server_models_ActiveUserModel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/models/ActiveUserModel */ \"(api)/./src/server/models/ActiveUserModel.ts\");\n/* harmony import */ var _server_models_ChatModel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/models/ChatModel */ \"(api)/./src/server/models/ChatModel.ts\");\n/* harmony import */ var _server_models_MessageModel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/models/MessageModel */ \"(api)/./src/server/models/MessageModel.ts\");\n\n\n\n\n\nconst secretKey = process.env.NEXT_PUBLIC_SECRET_KEY;\nconst waitingUsers = {};\nconst activeUsers = {};\nconst chats = {};\nfunction addActiveUser(user) {\n    activeUsers[user.loginId] = user;\n}\nfunction getChat(roomId) {\n    return chats[roomId] ?? null;\n}\nfunction getActiveUser(search) {\n    if (typeof search === \"string\") {\n        for(const id in activeUsers){\n            const user = activeUsers[id];\n            if (user.socketIds.includes(search) || user.email === search || user.loginId === search) {\n                return user;\n            }\n        }\n    } else {\n        const { socketId, loginId, email } = search;\n        for(const id in activeUsers){\n            const user = activeUsers[id];\n            if (user.socketIds.includes(socketId) || email && user.email === email || loginId && user.loginId === loginId) {\n                return user;\n            }\n        }\n    }\n    return null;\n}\nfunction getChatsCount(id) {\n    return getActiveUser(id)?.rooms.length;\n}\nasync function delActiveUser(user) {\n    delete activeUsers[user.loginId];\n    await _server_models_ActiveUserModel__WEBPACK_IMPORTED_MODULE_2__[\"default\"].deleteOne({\n        _id: user.id\n    });\n}\n// This funtion is used for removing user from waiting list\nfunction delWaitingUser(id) {\n    delete waitingUsers[id];\n}\nasync function init() {\n    const _chats = _server_models_ChatModel__WEBPACK_IMPORTED_MODULE_3__[\"default\"].find().populate(\"users\").populate({\n        path: \"messages\",\n        populate: {\n            path: \"sender\"\n        }\n    });\n    for await (const chat of _chats){\n        const userIds = chat.users.map((user)=>user.loginId);\n        const messages = {};\n        for (const message of chat.messages){\n            if (message.sender === null) {\n                return;\n            }\n            messages[message._id.toString()] = {\n                ...message.optimizedVersion,\n                senderId: message.sender.loginId\n            };\n        }\n        chats[chat._id.toString()] = {\n            ...chat.optimizedVersion,\n            userIds,\n            messages\n        };\n    }\n    for await (const activeUser of _server_models_ActiveUserModel__WEBPACK_IMPORTED_MODULE_2__[\"default\"].find()){\n        const chats = await _server_models_ChatModel__WEBPACK_IMPORTED_MODULE_3__[\"default\"].find({\n            users: {\n                $in: [\n                    activeUser._id\n                ]\n            }\n        });\n        const obj = {\n            ...activeUser.optimizedVersion,\n            rooms: chats.map((chat)=>chat._id.toString())\n        };\n        activeUsers[activeUser.loginId] = obj;\n    }\n}\nasync function createChat(users) {\n    const _chat = {\n        _id: new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Types).ObjectId(),\n        users: [],\n        messages: []\n    };\n    const roomId = _chat._id.toString();\n    // TODO: this shouldn't happen as now new users are added to active users collection instead of users collection.\n    // find a way to take users from users and fill it in active users.\n    for(let i = 0; i < users.length; i++){\n        const { email, loginId } = users[i];\n        const user = await _server_models_ActiveUserModel__WEBPACK_IMPORTED_MODULE_2__[\"default\"].create({\n            email,\n            loginId,\n            currentChat: _chat._id\n        });\n        _chat.users.push(user.id);\n        users[i].id = user._id.toString();\n        users[i].currentRoomId = roomId;\n        users[i].rooms.push(roomId);\n        users[i].socketConnections.map((socket)=>{\n            socket.join(roomId);\n        });\n        addActiveUser(users[i]);\n    }\n    const chat = await _server_models_ChatModel__WEBPACK_IMPORTED_MODULE_3__[\"default\"].create(_chat);\n    const optimizedChat = {\n        ...chat.optimizedVersion,\n        userIds: users.map((user)=>user.loginId)\n    };\n    chats[roomId] = optimizedChat;\n    return {\n        id: roomId,\n        ...optimizedChat\n    };\n}\nasync function closeChat(roomId) {\n    await _server_models_ChatModel__WEBPACK_IMPORTED_MODULE_3__[\"default\"].deleteOne({\n        _id: roomId\n    });\n    const chat = getChat(roomId);\n    if (!chat) {\n        return null;\n    }\n    await _server_models_MessageModel__WEBPACK_IMPORTED_MODULE_4__[\"default\"].deleteMany({\n        _id: {\n            $in: Object.keys(chat.messages)\n        }\n    });\n    const inactiveList = [];\n    for (const userId of chat.userIds){\n        const user = getActiveUser(userId);\n        if (!user) {\n            continue;\n        }\n        user.rooms.forEach((id, i)=>{\n            if (id === roomId) {\n                user.rooms.splice(i, 1);\n            }\n        });\n        await _server_models_ChatModel__WEBPACK_IMPORTED_MODULE_3__[\"default\"].deleteOne({\n            _id: roomId\n        });\n        if (getChatsCount(userId) === 0) {\n            user.currentRoomId = null;\n            await delActiveUser(user);\n            if (!inactiveList.includes(user.loginId)) {\n                inactiveList.push(user.loginId);\n            }\n        }\n    }\n    delete chats[roomId];\n    return inactiveList;\n}\nfunction chatExists(roomId) {\n    return Boolean(getChat(roomId));\n}\nasync function addMessage(roomId, { message, time, senderId, type = \"message\", containsBadword, replyTo }) {\n    const sender = getActiveUser(senderId);\n    message = crypto_js__WEBPACK_IMPORTED_MODULE_1___default().AES.encrypt(message, secretKey).toString();\n    if (!sender) {\n        return null;\n    }\n    if (!chats[roomId]) {\n        return null;\n    }\n    const optimizedMessage = {\n        ...(await _server_models_MessageModel__WEBPACK_IMPORTED_MODULE_4__[\"default\"].create({\n            message: message,\n            sender: new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Types).ObjectId(sender.id),\n            type,\n            createdAt: new Date(time),\n            containsBadword,\n            replyTo\n        })).optimizedVersion,\n        senderId\n    };\n    await _server_models_ChatModel__WEBPACK_IMPORTED_MODULE_3__[\"default\"].updateOne({\n        _id: roomId\n    }, {\n        $push: {\n            messages: optimizedMessage.id\n        }\n    });\n    chats[roomId].messages[optimizedMessage.id] = optimizedMessage;\n    return optimizedMessage;\n}\nasync function removeMessage(roomId, messageId) {\n    if (!chats[roomId]) {\n        return false;\n    }\n    try {\n        await _server_models_MessageModel__WEBPACK_IMPORTED_MODULE_4__[\"default\"].deleteOne({\n            _id: messageId\n        });\n    } catch  {\n        return false;\n    }\n    delete chats[roomId].messages[messageId];\n    return true;\n}\nasync function editMessage(roomId, { id, message, oldMessage }) {\n    if (!chats[roomId]) {\n        return false;\n    }\n    if (!chats[roomId].messages[id]) {\n        return false;\n    }\n    message = crypto_js__WEBPACK_IMPORTED_MODULE_1___default().AES.encrypt(message, secretKey).toString();\n    try {\n        await _server_models_MessageModel__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findOneAndUpdate({\n            _id: id\n        }, {\n            $set: {\n                message,\n                isEdited: true\n            },\n            $push: {\n                oldMessages: oldMessage\n            }\n        }, {\n            new: true\n        });\n        chats[roomId].messages[id].message = message;\n        chats[roomId].messages[id].isEdited = true;\n        if (!Array.isArray(chats[roomId].messages[id].oldMessages)) {\n            chats[roomId].messages[id].oldMessages = [];\n        }\n        chats[roomId].messages[id]?.oldMessages?.push(oldMessage);\n        return chats[roomId].messages[id];\n    } catch  {\n        return false;\n    }\n}\nasync function seenMessage(roomId, messageId) {\n    if (!chats[roomId]) {\n        return false;\n    }\n    const isRead = true;\n    try {\n        const checkIfRead = await _server_models_MessageModel__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findById(messageId);\n        if (checkIfRead?.isRead) {\n            return;\n        }\n        await _server_models_MessageModel__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findOneAndUpdate({\n            _id: messageId\n        }, {\n            $set: {\n                isRead: isRead\n            }\n        }, {\n            new: true\n        });\n        chats[roomId].messages[messageId].isRead = isRead;\n    } catch  {\n        return false;\n    }\n    return true;\n}\nfunction getRandomPairFromWaitingList() {\n    /**\n   * Since we indexed waiting users by emailOrLoginId, we need to first\n   * retrieve all the keys which would be used for getting random users\n   */ const waitingUserIds = Object.keys(waitingUsers);\n    const pairedUsers = [];\n    for(let i = 0; i < 2; i++){\n        const randomIndex = Math.floor(Math.random() * waitingUserIds.length);\n        const randomId = waitingUserIds[randomIndex];\n        pairedUsers.push(waitingUsers[randomId]);\n        delWaitingUser(randomId);\n        waitingUserIds.splice(randomIndex, 1);\n    }\n    return pairedUsers;\n}\nfunction isUserActive(id) {\n    return Boolean(activeUsers[id]);\n}\nfunction addToWaitingList({ loginId, email, socket }) {\n    waitingUsers[loginId] = new Proxy({\n        loginId,\n        email,\n        socketConnections: [\n            socket\n        ],\n        socketIds: [\n            socket.id\n        ],\n        rooms: [],\n        currentRoomId: null\n    }, {\n        get (target, prop, receiver) {\n            if (prop === \"loginId\") {\n                return target.loginId;\n            }\n            return Reflect.get(target, prop, receiver);\n        }\n    });\n}\nfunction getWaitingUserLen() {\n    return Object.keys(waitingUsers).length;\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBSyxFQUNMcUMsTUFBTSxFQUtQO0lBQ0NsRCxZQUFZLENBQUNLLFFBQVEsR0FBRyxJQUFJK0YsTUFDMUI7UUFDRS9GO1FBQ0FRO1FBQ0FvQyxtQkFBbUI7WUFBQ0M7U0FBTztRQUMzQnZDLFdBQVc7WUFBQ3VDLE9BQU94QyxFQUFFO1NBQUM7UUFDdEJNLE9BQU8sRUFBRTtRQUNUZ0MsZUFBZTtJQUNqQixHQUNBO1FBQ0VxRCxLQUFJQyxNQUFNLEVBQUVDLElBQUksRUFBRUMsUUFBUTtZQUN4QixJQUFJRCxTQUFTLFdBQVc7Z0JBQ3RCLE9BQU9ELE9BQU9qRyxPQUFPO1lBQ3ZCO1lBRUEsT0FBT29HLFFBQVFKLEdBQUcsQ0FBQ0MsUUFBUUMsTUFBTUM7UUFDbkM7SUFDRjtBQUVKO0FBRUEsU0FBU0U7SUFDUCxPQUFPbkQsT0FBT0MsSUFBSSxDQUFDeEQsY0FBY2lCLE1BQU07QUFDekM7QUFrQkUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93aGlzY2hhdC8uL3NyYy9zZXJ2ZXIvbGliL2xpYi50cz8wODZkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNvY2tldCB9IGZyb20gJ3NvY2tldC5pbyc7XG5pbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuaW1wb3J0IENyeXB0b0pTIGZyb20gJ2NyeXB0by1qcyc7XG5cbmltcG9ydCBBY3RpdmVVc2VyIGZyb20gJ0Avc2VydmVyL21vZGVscy9BY3RpdmVVc2VyTW9kZWwnO1xuaW1wb3J0IENoYXQgZnJvbSAnQC9zZXJ2ZXIvbW9kZWxzL0NoYXRNb2RlbCc7XG5pbXBvcnQgTWVzc2FnZSBmcm9tICdAL3NlcnZlci9tb2RlbHMvTWVzc2FnZU1vZGVsJztcbmltcG9ydCB7XG4gIFJvb21UeXBlLFxuICBhY3RpdmVVc2VySWRUeXBlLFxuICBBY3RpdmVVc2VyVHlwZSxcbiAgQ2hhdFR5cGUsXG4gIE1lc3NhZ2VJZFR5cGUsXG4gIE1lc3NhZ2VUeXBlLFxufSBmcm9tICdAL3R5cGVzL3R5cGVzJztcblxuY29uc3Qgc2VjcmV0S2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0VDUkVUX0tFWTtcblxuY29uc3Qgd2FpdGluZ1VzZXJzOiBhY3RpdmVVc2VySWRUeXBlID0ge307XG5cbmNvbnN0IGFjdGl2ZVVzZXJzOiBhY3RpdmVVc2VySWRUeXBlID0ge307XG5cbmNvbnN0IGNoYXRzOiBSb29tVHlwZSA9IHt9O1xuXG5mdW5jdGlvbiBhZGRBY3RpdmVVc2VyKHVzZXI6IEFjdGl2ZVVzZXJUeXBlKSB7XG4gIGFjdGl2ZVVzZXJzW3VzZXIubG9naW5JZF0gPSB1c2VyO1xufVxuXG5mdW5jdGlvbiBnZXRDaGF0KHJvb21JZDogc3RyaW5nKTogQ2hhdFR5cGUge1xuICByZXR1cm4gY2hhdHNbcm9vbUlkXSA/PyBudWxsO1xufVxuXG5mdW5jdGlvbiBnZXRBY3RpdmVVc2VyKFxuICBzZWFyY2g6IHsgc29ja2V0SWQ6IHN0cmluZzsgbG9naW5JZD86IHN0cmluZzsgZW1haWw/OiBudWxsIHwgc3RyaW5nIH0gfCBzdHJpbmdcbikge1xuICBpZiAodHlwZW9mIHNlYXJjaCA9PT0gJ3N0cmluZycpIHtcbiAgICBmb3IgKGNvbnN0IGlkIGluIGFjdGl2ZVVzZXJzKSB7XG4gICAgICBjb25zdCB1c2VyID0gYWN0aXZlVXNlcnNbaWRdO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHVzZXIuc29ja2V0SWRzLmluY2x1ZGVzKHNlYXJjaCkgfHxcbiAgICAgICAgdXNlci5lbWFpbCA9PT0gc2VhcmNoIHx8XG4gICAgICAgIHVzZXIubG9naW5JZCA9PT0gc2VhcmNoXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNvbnN0IHsgc29ja2V0SWQsIGxvZ2luSWQsIGVtYWlsIH0gPSBzZWFyY2g7XG4gICAgZm9yIChjb25zdCBpZCBpbiBhY3RpdmVVc2Vycykge1xuICAgICAgY29uc3QgdXNlciA9IGFjdGl2ZVVzZXJzW2lkXTtcblxuICAgICAgaWYgKFxuICAgICAgICB1c2VyLnNvY2tldElkcy5pbmNsdWRlcyhzb2NrZXRJZCkgfHxcbiAgICAgICAgKGVtYWlsICYmIHVzZXIuZW1haWwgPT09IGVtYWlsKSB8fFxuICAgICAgICAobG9naW5JZCAmJiB1c2VyLmxvZ2luSWQgPT09IGxvZ2luSWQpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIGdldENoYXRzQ291bnQoaWQ6IHN0cmluZykge1xuICByZXR1cm4gZ2V0QWN0aXZlVXNlcihpZCk/LnJvb21zLmxlbmd0aDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGVsQWN0aXZlVXNlcih1c2VyOiBBY3RpdmVVc2VyVHlwZSkge1xuICBkZWxldGUgYWN0aXZlVXNlcnNbdXNlci5sb2dpbklkXTtcbiAgYXdhaXQgQWN0aXZlVXNlci5kZWxldGVPbmUoe1xuICAgIF9pZDogdXNlci5pZCxcbiAgfSk7XG59XG5cbi8vIFRoaXMgZnVudGlvbiBpcyB1c2VkIGZvciByZW1vdmluZyB1c2VyIGZyb20gd2FpdGluZyBsaXN0XG5mdW5jdGlvbiBkZWxXYWl0aW5nVXNlcihpZDogc3RyaW5nKSB7XG4gIGRlbGV0ZSB3YWl0aW5nVXNlcnNbaWRdO1xufVxuXG5hc3luYyBmdW5jdGlvbiBpbml0KCkge1xuICBjb25zdCBfY2hhdHMgPSBDaGF0LmZpbmQoKVxuICAgIC5wb3B1bGF0ZSgndXNlcnMnKVxuICAgIC5wb3B1bGF0ZSh7IHBhdGg6ICdtZXNzYWdlcycsIHBvcHVsYXRlOiB7IHBhdGg6ICdzZW5kZXInIH0gfSk7XG4gIGZvciBhd2FpdCAoY29uc3QgY2hhdCBvZiBfY2hhdHMpIHtcbiAgICBjb25zdCB1c2VySWRzID0gY2hhdC51c2Vycy5tYXAodXNlciA9PiB1c2VyLmxvZ2luSWQpIGFzIFtzdHJpbmcsIHN0cmluZ107XG4gICAgY29uc3QgbWVzc2FnZXM6IE1lc3NhZ2VJZFR5cGUgPSB7fTtcblxuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBjaGF0Lm1lc3NhZ2VzKSB7XG4gICAgICBpZiAobWVzc2FnZS5zZW5kZXIgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtZXNzYWdlc1ttZXNzYWdlLl9pZC50b1N0cmluZygpXSA9IHtcbiAgICAgICAgLi4ubWVzc2FnZS5vcHRpbWl6ZWRWZXJzaW9uLFxuICAgICAgICBzZW5kZXJJZDogbWVzc2FnZS5zZW5kZXIubG9naW5JZCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY2hhdHNbY2hhdC5faWQudG9TdHJpbmcoKV0gPSB7XG4gICAgICAuLi5jaGF0Lm9wdGltaXplZFZlcnNpb24sXG4gICAgICB1c2VySWRzLFxuICAgICAgbWVzc2FnZXMsXG4gICAgfTtcbiAgfVxuXG4gIHR5cGUgb2JqVHlwZSA9IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIGVtYWlsOiBzdHJpbmcgfCBudWxsO1xuICAgIGxvZ2luSWQ6IHN0cmluZztcbiAgICBzb2NrZXRDb25uZWN0aW9uczogU29ja2V0W107XG4gICAgc29ja2V0SWRzOiBzdHJpbmdbXTtcbiAgICBjdXJyZW50Um9vbUlkOiBzdHJpbmcgfCBudWxsO1xuICAgIHJvb21zOiBzdHJpbmdbXTtcbiAgfTtcblxuICBmb3IgYXdhaXQgKGNvbnN0IGFjdGl2ZVVzZXIgb2YgQWN0aXZlVXNlci5maW5kKCkpIHtcbiAgICBjb25zdCBjaGF0cyA9IGF3YWl0IENoYXQuZmluZCh7XG4gICAgICB1c2Vyczoge1xuICAgICAgICAkaW46IFthY3RpdmVVc2VyLl9pZF0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3Qgb2JqOiBvYmpUeXBlID0ge1xuICAgICAgLi4uYWN0aXZlVXNlci5vcHRpbWl6ZWRWZXJzaW9uLFxuICAgICAgcm9vbXM6IGNoYXRzLm1hcChjaGF0ID0+IGNoYXQuX2lkLnRvU3RyaW5nKCkpIGFzIHN0cmluZ1tdLFxuICAgIH07XG5cbiAgICBhY3RpdmVVc2Vyc1thY3RpdmVVc2VyLmxvZ2luSWRdID0gb2JqO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNoYXQodXNlcnM6IEFjdGl2ZVVzZXJUeXBlW10pIHtcbiAgY29uc3QgX2NoYXQ6IHtcbiAgICBfaWQ6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkO1xuICAgIHVzZXJzOiBzdHJpbmdbXTtcbiAgICBtZXNzYWdlczogYW55W107XG4gIH0gPSB7XG4gICAgX2lkOiBuZXcgbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQoKSxcbiAgICB1c2VyczogW10sXG4gICAgbWVzc2FnZXM6IFtdLFxuICB9O1xuXG4gIGNvbnN0IHJvb21JZCA9IF9jaGF0Ll9pZC50b1N0cmluZygpO1xuXG4gIC8vIFRPRE86IHRoaXMgc2hvdWxkbid0IGhhcHBlbiBhcyBub3cgbmV3IHVzZXJzIGFyZSBhZGRlZCB0byBhY3RpdmUgdXNlcnMgY29sbGVjdGlvbiBpbnN0ZWFkIG9mIHVzZXJzIGNvbGxlY3Rpb24uXG4gIC8vIGZpbmQgYSB3YXkgdG8gdGFrZSB1c2VycyBmcm9tIHVzZXJzIGFuZCBmaWxsIGl0IGluIGFjdGl2ZSB1c2Vycy5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2Vycy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHsgZW1haWwsIGxvZ2luSWQgfSA9IHVzZXJzW2ldO1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBBY3RpdmVVc2VyLmNyZWF0ZSh7XG4gICAgICBlbWFpbCxcbiAgICAgIGxvZ2luSWQsXG4gICAgICBjdXJyZW50Q2hhdDogX2NoYXQuX2lkLFxuICAgIH0pO1xuXG4gICAgX2NoYXQudXNlcnMucHVzaCh1c2VyLmlkKTtcblxuICAgIHVzZXJzW2ldLmlkID0gdXNlci5faWQudG9TdHJpbmcoKTtcbiAgICB1c2Vyc1tpXS5jdXJyZW50Um9vbUlkID0gcm9vbUlkO1xuICAgIHVzZXJzW2ldLnJvb21zLnB1c2gocm9vbUlkKTtcbiAgICB1c2Vyc1tpXS5zb2NrZXRDb25uZWN0aW9ucy5tYXAoc29ja2V0ID0+IHtcbiAgICAgIHNvY2tldC5qb2luKHJvb21JZCk7XG4gICAgfSk7XG5cbiAgICBhZGRBY3RpdmVVc2VyKHVzZXJzW2ldKTtcbiAgfVxuXG4gIGNvbnN0IGNoYXQgPSBhd2FpdCBDaGF0LmNyZWF0ZShfY2hhdCk7XG5cbiAgY29uc3Qgb3B0aW1pemVkQ2hhdDogQ2hhdFR5cGUgPSB7XG4gICAgLi4uY2hhdC5vcHRpbWl6ZWRWZXJzaW9uLFxuICAgIHVzZXJJZHM6IHVzZXJzLm1hcCh1c2VyID0+IHVzZXIubG9naW5JZCkgYXMgW3N0cmluZywgc3RyaW5nXSxcbiAgfTtcblxuICBjaGF0c1tyb29tSWRdID0gb3B0aW1pemVkQ2hhdDtcblxuICByZXR1cm4geyBpZDogcm9vbUlkLCAuLi5vcHRpbWl6ZWRDaGF0IH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsb3NlQ2hhdChyb29tSWQ6IHN0cmluZykge1xuICBhd2FpdCBDaGF0LmRlbGV0ZU9uZSh7XG4gICAgX2lkOiByb29tSWQsXG4gIH0pO1xuXG4gIGNvbnN0IGNoYXQgPSBnZXRDaGF0KHJvb21JZCk7XG5cbiAgaWYgKCFjaGF0KSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBhd2FpdCBNZXNzYWdlLmRlbGV0ZU1hbnkoe1xuICAgIF9pZDoge1xuICAgICAgJGluOiBPYmplY3Qua2V5cyhjaGF0Lm1lc3NhZ2VzKSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBpbmFjdGl2ZUxpc3Q6IHN0cmluZ1tdID0gW107XG5cbiAgZm9yIChjb25zdCB1c2VySWQgb2YgY2hhdC51c2VySWRzKSB7XG4gICAgY29uc3QgdXNlciA9IGdldEFjdGl2ZVVzZXIodXNlcklkKTtcblxuICAgIGlmICghdXNlcikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgdXNlci5yb29tcy5mb3JFYWNoKChpZCwgaSkgPT4ge1xuICAgICAgaWYgKGlkID09PSByb29tSWQpIHtcbiAgICAgICAgdXNlci5yb29tcy5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBhd2FpdCBDaGF0LmRlbGV0ZU9uZSh7XG4gICAgICBfaWQ6IHJvb21JZCxcbiAgICB9KTtcblxuICAgIGlmIChnZXRDaGF0c0NvdW50KHVzZXJJZCkgPT09IDApIHtcbiAgICAgIHVzZXIuY3VycmVudFJvb21JZCA9IG51bGw7XG4gICAgICBhd2FpdCBkZWxBY3RpdmVVc2VyKHVzZXIpO1xuXG4gICAgICBpZiAoIWluYWN0aXZlTGlzdC5pbmNsdWRlcyh1c2VyLmxvZ2luSWQpKSB7XG4gICAgICAgIGluYWN0aXZlTGlzdC5wdXNoKHVzZXIubG9naW5JZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZGVsZXRlIGNoYXRzW3Jvb21JZF07XG5cbiAgcmV0dXJuIGluYWN0aXZlTGlzdDtcbn1cblxuZnVuY3Rpb24gY2hhdEV4aXN0cyhyb29tSWQ6IHN0cmluZykge1xuICByZXR1cm4gQm9vbGVhbihnZXRDaGF0KHJvb21JZCkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhZGRNZXNzYWdlKFxuICByb29tSWQ6IHN0cmluZyxcbiAge1xuICAgIG1lc3NhZ2UsXG4gICAgdGltZSxcbiAgICBzZW5kZXJJZCxcbiAgICB0eXBlID0gJ21lc3NhZ2UnLFxuICAgIGNvbnRhaW5zQmFkd29yZCxcbiAgICByZXBseVRvLFxuICB9OiBNZXNzYWdlVHlwZVxuKSB7XG4gIGNvbnN0IHNlbmRlciA9IGdldEFjdGl2ZVVzZXIoc2VuZGVySWQpO1xuXG4gIG1lc3NhZ2UgPSBDcnlwdG9KUy5BRVMuZW5jcnlwdChtZXNzYWdlLCBzZWNyZXRLZXkgYXMgc3RyaW5nKS50b1N0cmluZygpO1xuXG4gIGlmICghc2VuZGVyKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAoIWNoYXRzW3Jvb21JZF0pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IG9wdGltaXplZE1lc3NhZ2UgPSB7XG4gICAgLi4uKFxuICAgICAgYXdhaXQgTWVzc2FnZS5jcmVhdGUoe1xuICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICBzZW5kZXI6IG5ldyBtb25nb29zZS5UeXBlcy5PYmplY3RJZChzZW5kZXIuaWQpLFxuICAgICAgICB0eXBlLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHRpbWUpLFxuICAgICAgICBjb250YWluc0JhZHdvcmQsXG4gICAgICAgIHJlcGx5VG8sXG4gICAgICB9KVxuICAgICkub3B0aW1pemVkVmVyc2lvbixcbiAgICBzZW5kZXJJZCxcbiAgfTtcblxuICBhd2FpdCBDaGF0LnVwZGF0ZU9uZShcbiAgICB7XG4gICAgICBfaWQ6IHJvb21JZCxcbiAgICB9LFxuICAgIHtcbiAgICAgICRwdXNoOiB7XG4gICAgICAgIG1lc3NhZ2VzOiBvcHRpbWl6ZWRNZXNzYWdlLmlkLFxuICAgICAgfSxcbiAgICB9XG4gICk7XG5cbiAgY2hhdHNbcm9vbUlkXS5tZXNzYWdlc1tvcHRpbWl6ZWRNZXNzYWdlLmlkXSA9IG9wdGltaXplZE1lc3NhZ2U7XG5cbiAgcmV0dXJuIG9wdGltaXplZE1lc3NhZ2U7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlbW92ZU1lc3NhZ2Uocm9vbUlkOiBzdHJpbmcsIG1lc3NhZ2VJZDogc3RyaW5nKSB7XG4gIGlmICghY2hhdHNbcm9vbUlkXSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgTWVzc2FnZS5kZWxldGVPbmUoe1xuICAgICAgX2lkOiBtZXNzYWdlSWQsXG4gICAgfSk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGRlbGV0ZSBjaGF0c1tyb29tSWRdLm1lc3NhZ2VzW21lc3NhZ2VJZF07XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGVkaXRNZXNzYWdlKFxuICByb29tSWQ6IHN0cmluZyxcbiAge1xuICAgIGlkLFxuICAgIG1lc3NhZ2UsXG4gICAgb2xkTWVzc2FnZSxcbiAgfTogeyBpZDogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmc7IG9sZE1lc3NhZ2U6IHN0cmluZyB9XG4pIHtcbiAgaWYgKCFjaGF0c1tyb29tSWRdKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKCFjaGF0c1tyb29tSWRdLm1lc3NhZ2VzW2lkXSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIG1lc3NhZ2UgPSBDcnlwdG9KUy5BRVMuZW5jcnlwdChtZXNzYWdlLCBzZWNyZXRLZXkgYXMgc3RyaW5nKS50b1N0cmluZygpO1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgTWVzc2FnZS5maW5kT25lQW5kVXBkYXRlKFxuICAgICAgeyBfaWQ6IGlkIH0sXG4gICAgICB7XG4gICAgICAgICRzZXQ6IHsgbWVzc2FnZSwgaXNFZGl0ZWQ6IHRydWUgfSxcbiAgICAgICAgJHB1c2g6IHsgb2xkTWVzc2FnZXM6IG9sZE1lc3NhZ2UgfSxcbiAgICAgIH0sXG4gICAgICB7IG5ldzogdHJ1ZSB9XG4gICAgKTtcblxuICAgIGNoYXRzW3Jvb21JZF0ubWVzc2FnZXNbaWRdLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgIGNoYXRzW3Jvb21JZF0ubWVzc2FnZXNbaWRdLmlzRWRpdGVkID0gdHJ1ZTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoY2hhdHNbcm9vbUlkXS5tZXNzYWdlc1tpZF0ub2xkTWVzc2FnZXMpKSB7XG4gICAgICBjaGF0c1tyb29tSWRdLm1lc3NhZ2VzW2lkXS5vbGRNZXNzYWdlcyA9IFtdO1xuICAgIH1cbiAgICBjaGF0c1tyb29tSWRdLm1lc3NhZ2VzW2lkXT8ub2xkTWVzc2FnZXM/LnB1c2gob2xkTWVzc2FnZSk7XG4gICAgcmV0dXJuIGNoYXRzW3Jvb21JZF0ubWVzc2FnZXNbaWRdO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gc2Vlbk1lc3NhZ2Uocm9vbUlkOiBzdHJpbmcsIG1lc3NhZ2VJZDogc3RyaW5nKSB7XG4gIGlmICghY2hhdHNbcm9vbUlkXSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IGlzUmVhZCA9IHRydWU7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBjaGVja0lmUmVhZCA9IGF3YWl0IE1lc3NhZ2UuZmluZEJ5SWQobWVzc2FnZUlkKTtcbiAgICBpZiAoY2hlY2tJZlJlYWQ/LmlzUmVhZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhd2FpdCBNZXNzYWdlLmZpbmRPbmVBbmRVcGRhdGUoXG4gICAgICB7XG4gICAgICAgIF9pZDogbWVzc2FnZUlkLFxuICAgICAgfSxcbiAgICAgIHsgJHNldDogeyBpc1JlYWQ6IGlzUmVhZCB9IH0sXG4gICAgICB7IG5ldzogdHJ1ZSB9XG4gICAgKTtcblxuICAgIGNoYXRzW3Jvb21JZF0ubWVzc2FnZXNbbWVzc2FnZUlkXS5pc1JlYWQgPSBpc1JlYWQ7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0UmFuZG9tUGFpckZyb21XYWl0aW5nTGlzdCgpIHtcbiAgLyoqXG4gICAqIFNpbmNlIHdlIGluZGV4ZWQgd2FpdGluZyB1c2VycyBieSBlbWFpbE9yTG9naW5JZCwgd2UgbmVlZCB0byBmaXJzdFxuICAgKiByZXRyaWV2ZSBhbGwgdGhlIGtleXMgd2hpY2ggd291bGQgYmUgdXNlZCBmb3IgZ2V0dGluZyByYW5kb20gdXNlcnNcbiAgICovXG4gIGNvbnN0IHdhaXRpbmdVc2VySWRzID0gT2JqZWN0LmtleXMod2FpdGluZ1VzZXJzKTtcbiAgY29uc3QgcGFpcmVkVXNlcnMgPSBbXTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IDI7IGkrKykge1xuICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogd2FpdGluZ1VzZXJJZHMubGVuZ3RoKTtcblxuICAgIGNvbnN0IHJhbmRvbUlkID0gd2FpdGluZ1VzZXJJZHNbcmFuZG9tSW5kZXhdO1xuICAgIHBhaXJlZFVzZXJzLnB1c2god2FpdGluZ1VzZXJzW3JhbmRvbUlkXSk7XG5cbiAgICBkZWxXYWl0aW5nVXNlcihyYW5kb21JZCk7XG4gICAgd2FpdGluZ1VzZXJJZHMuc3BsaWNlKHJhbmRvbUluZGV4LCAxKTtcbiAgfVxuXG4gIHJldHVybiBwYWlyZWRVc2Vycztcbn1cblxuZnVuY3Rpb24gaXNVc2VyQWN0aXZlKGlkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIEJvb2xlYW4oYWN0aXZlVXNlcnNbaWRdKTtcbn1cblxuZnVuY3Rpb24gYWRkVG9XYWl0aW5nTGlzdCh7XG4gIGxvZ2luSWQsXG4gIGVtYWlsLFxuICBzb2NrZXQsXG59OiB7XG4gIGxvZ2luSWQ6IHN0cmluZztcbiAgZW1haWw/OiBzdHJpbmc7XG4gIHNvY2tldDogU29ja2V0O1xufSkge1xuICB3YWl0aW5nVXNlcnNbbG9naW5JZF0gPSBuZXcgUHJveHkoXG4gICAge1xuICAgICAgbG9naW5JZCxcbiAgICAgIGVtYWlsLFxuICAgICAgc29ja2V0Q29ubmVjdGlvbnM6IFtzb2NrZXRdLFxuICAgICAgc29ja2V0SWRzOiBbc29ja2V0LmlkXSxcbiAgICAgIHJvb21zOiBbXSxcbiAgICAgIGN1cnJlbnRSb29tSWQ6IG51bGwsXG4gICAgfSxcbiAgICB7XG4gICAgICBnZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikge1xuICAgICAgICBpZiAocHJvcCA9PT0gJ2xvZ2luSWQnKSB7XG4gICAgICAgICAgcmV0dXJuIHRhcmdldC5sb2dpbklkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFJlZmxlY3QuZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpO1xuICAgICAgfSxcbiAgICB9XG4gICk7XG59XG5cbmZ1bmN0aW9uIGdldFdhaXRpbmdVc2VyTGVuKCkge1xuICByZXR1cm4gT2JqZWN0LmtleXMod2FpdGluZ1VzZXJzKS5sZW5ndGg7XG59XG5cbmV4cG9ydCB7XG4gIGluaXQsXG4gIGNyZWF0ZUNoYXQsXG4gIGNsb3NlQ2hhdCxcbiAgY2hhdEV4aXN0cyxcbiAgZ2V0Q2hhdCxcbiAgYWRkTWVzc2FnZSxcbiAgcmVtb3ZlTWVzc2FnZSxcbiAgZWRpdE1lc3NhZ2UsXG4gIGdldFdhaXRpbmdVc2VyTGVuLFxuICBkZWxXYWl0aW5nVXNlcixcbiAgZ2V0UmFuZG9tUGFpckZyb21XYWl0aW5nTGlzdCxcbiAgaXNVc2VyQWN0aXZlLFxuICBnZXRBY3RpdmVVc2VyLFxuICBhZGRUb1dhaXRpbmdMaXN0LFxuICBzZWVuTWVzc2FnZSxcbn07XG4iXSwibmFtZXMiOlsibW9uZ29vc2UiLCJDcnlwdG9KUyIsIkFjdGl2ZVVzZXIiLCJDaGF0IiwiTWVzc2FnZSIsInNlY3JldEtleSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TRUNSRVRfS0VZIiwid2FpdGluZ1VzZXJzIiwiYWN0aXZlVXNlcnMiLCJjaGF0cyIsImFkZEFjdGl2ZVVzZXIiLCJ1c2VyIiwibG9naW5JZCIsImdldENoYXQiLCJyb29tSWQiLCJnZXRBY3RpdmVVc2VyIiwic2VhcmNoIiwiaWQiLCJzb2NrZXRJZHMiLCJpbmNsdWRlcyIsImVtYWlsIiwic29ja2V0SWQiLCJnZXRDaGF0c0NvdW50Iiwicm9vbXMiLCJsZW5ndGgiLCJkZWxBY3RpdmVVc2VyIiwiZGVsZXRlT25lIiwiX2lkIiwiZGVsV2FpdGluZ1VzZXIiLCJpbml0IiwiX2NoYXRzIiwiZmluZCIsInBvcHVsYXRlIiwicGF0aCIsImNoYXQiLCJ1c2VySWRzIiwidXNlcnMiLCJtYXAiLCJtZXNzYWdlcyIsIm1lc3NhZ2UiLCJzZW5kZXIiLCJ0b1N0cmluZyIsIm9wdGltaXplZFZlcnNpb24iLCJzZW5kZXJJZCIsImFjdGl2ZVVzZXIiLCIkaW4iLCJvYmoiLCJjcmVhdGVDaGF0IiwiX2NoYXQiLCJUeXBlcyIsIk9iamVjdElkIiwiaSIsImNyZWF0ZSIsImN1cnJlbnRDaGF0IiwicHVzaCIsImN1cnJlbnRSb29tSWQiLCJzb2NrZXRDb25uZWN0aW9ucyIsInNvY2tldCIsImpvaW4iLCJvcHRpbWl6ZWRDaGF0IiwiY2xvc2VDaGF0IiwiZGVsZXRlTWFueSIsIk9iamVjdCIsImtleXMiLCJpbmFjdGl2ZUxpc3QiLCJ1c2VySWQiLCJmb3JFYWNoIiwic3BsaWNlIiwiY2hhdEV4aXN0cyIsIkJvb2xlYW4iLCJhZGRNZXNzYWdlIiwidGltZSIsInR5cGUiLCJjb250YWluc0JhZHdvcmQiLCJyZXBseVRvIiwiQUVTIiwiZW5jcnlwdCIsIm9wdGltaXplZE1lc3NhZ2UiLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlT25lIiwiJHB1c2giLCJyZW1vdmVNZXNzYWdlIiwibWVzc2FnZUlkIiwiZWRpdE1lc3NhZ2UiLCJvbGRNZXNzYWdlIiwiZmluZE9uZUFuZFVwZGF0ZSIsIiRzZXQiLCJpc0VkaXRlZCIsIm9sZE1lc3NhZ2VzIiwibmV3IiwiQXJyYXkiLCJpc0FycmF5Iiwic2Vlbk1lc3NhZ2UiLCJpc1JlYWQiLCJjaGVja0lmUmVhZCIsImZpbmRCeUlkIiwiZ2V0UmFuZG9tUGFpckZyb21XYWl0aW5nTGlzdCIsIndhaXRpbmdVc2VySWRzIiwicGFpcmVkVXNlcnMiLCJyYW5kb21JbmRleCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInJhbmRvbUlkIiwiaXNVc2VyQWN0aXZlIiwiYWRkVG9XYWl0aW5nTGlzdCIsIlByb3h5IiwiZ2V0IiwidGFyZ2V0IiwicHJvcCIsInJlY2VpdmVyIiwiUmVmbGVjdCIsImdldFdhaXRpbmdVc2VyTGVuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/server/lib/lib.ts\n");

/***/ }),

/***/ "(api)/./src/server/models/ActiveUserModel.ts":
/*!**********************************************!*\
  !*** ./src/server/models/ActiveUserModel.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ActiveUserModel: () => (/* binding */ ActiveUserModel),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst activeUserSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    email: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.Mixed,\n        default: null\n    },\n    loginId: {\n        type: String,\n        required: true\n    },\n    currentChat: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: \"Chat\"\n    }\n}, {\n    timestamps: true\n});\nactiveUserSchema.virtual(\"optimizedVersion\").get(function() {\n    return {\n        id: this.id,\n        email: this.email || null,\n        loginId: this.loginId,\n        socketConnections: [],\n        socketIds: [],\n        currentRoomId: this.currentChat?.toString() || null,\n        rooms: []\n    };\n});\nconst ActiveUserModel = mongoose__WEBPACK_IMPORTED_MODULE_0__.models.ActiveUser || (0,mongoose__WEBPACK_IMPORTED_MODULE_0__.model)(\"ActiveUser\", activeUserSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ActiveUserModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmVyL21vZGVscy9BY3RpdmVVc2VyTW9kZWwudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUF5RTtBQXFCekUsTUFBTUcsbUJBQW1CLElBQUlILDRDQUFNQSxDQUNqQztJQUNFSSxPQUFPO1FBQ0xDLE1BQU1MLDRDQUFNQSxDQUFDTSxLQUFLLENBQUNDLEtBQUs7UUFDeEJDLFNBQVM7SUFDWDtJQUNBQyxTQUFTO1FBQ1BKLE1BQU1LO1FBQ05DLFVBQVU7SUFDWjtJQUNBQyxhQUFhO1FBQ1hQLE1BQU1MLDRDQUFNQSxDQUFDTSxLQUFLLENBQUNPLFFBQVE7UUFDM0JDLEtBQUs7SUFDUDtBQUNGLEdBQ0E7SUFDRUMsWUFBWTtBQUNkO0FBR0ZaLGlCQUFpQmEsT0FBTyxDQUFDLG9CQUFvQkMsR0FBRyxDQUFDO0lBRy9DLE9BQU87UUFDTEMsSUFBSSxJQUFJLENBQUNBLEVBQUU7UUFDWGQsT0FBTyxJQUFJLENBQUNBLEtBQUssSUFBSTtRQUNyQkssU0FBUyxJQUFJLENBQUNBLE9BQU87UUFDckJVLG1CQUFtQixFQUFFO1FBQ3JCQyxXQUFXLEVBQUU7UUFDYkMsZUFBZSxJQUFJLENBQUNULFdBQVcsRUFBRVUsY0FBYztRQUMvQ0MsT0FBTyxFQUFFO0lBQ1g7QUFDRjtBQUVPLE1BQU1DLGtCQUNYdEIsNENBQU1BLENBQUN1QixVQUFVLElBQUl4QiwrQ0FBS0EsQ0FBQyxjQUFjRSxrQkFBa0I7QUFFN0QsaUVBQWVxQixlQUFlQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2hpc2NoYXQvLi9zcmMvc2VydmVyL21vZGVscy9BY3RpdmVVc2VyTW9kZWwudHM/YzBhZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTY2hlbWEsIERvY3VtZW50LCBNb2RlbCwgbW9kZWwsIFR5cGVzLCBtb2RlbHMgfSBmcm9tICdtb25nb29zZSc7XG5pbXBvcnQgeyBTb2NrZXQgfSBmcm9tICdzb2NrZXQuaW8nO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFjdGl2ZVVzZXJTY2hlbWFEb2N1bWVudCBleHRlbmRzIERvY3VtZW50IHtcbiAgZW1haWw6IHN0cmluZyB8IG51bGw7XG4gIGxvZ2luSWQ6IHN0cmluZztcbiAgY3VycmVudENoYXQ6IFR5cGVzLk9iamVjdElkIHwgbnVsbDtcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG4gIGlkOiBzdHJpbmc7XG4gIG9wdGltaXplZFZlcnNpb246IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIGVtYWlsOiBzdHJpbmcgfCBudWxsO1xuICAgIGxvZ2luSWQ6IHN0cmluZztcbiAgICBzb2NrZXRDb25uZWN0aW9uczogU29ja2V0W107XG4gICAgc29ja2V0SWRzOiBzdHJpbmdbXTtcbiAgICBjdXJyZW50Um9vbUlkOiBzdHJpbmcgfCBudWxsO1xuICAgIHJvb21zOiBzdHJpbmdbXTtcbiAgfTtcbn1cblxuY29uc3QgYWN0aXZlVXNlclNjaGVtYSA9IG5ldyBTY2hlbWE8QWN0aXZlVXNlclNjaGVtYURvY3VtZW50PihcbiAge1xuICAgIGVtYWlsOiB7XG4gICAgICB0eXBlOiBTY2hlbWEuVHlwZXMuTWl4ZWQsXG4gICAgICBkZWZhdWx0OiBudWxsLFxuICAgIH0sXG4gICAgbG9naW5JZDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgfSxcbiAgICBjdXJyZW50Q2hhdDoge1xuICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxuICAgICAgcmVmOiAnQ2hhdCcsXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHRpbWVzdGFtcHM6IHRydWUsXG4gIH1cbik7XG5cbmFjdGl2ZVVzZXJTY2hlbWEudmlydHVhbCgnb3B0aW1pemVkVmVyc2lvbicpLmdldChmdW5jdGlvbiAoXG4gIHRoaXM6IEFjdGl2ZVVzZXJTY2hlbWFEb2N1bWVudFxuKSB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHRoaXMuaWQsXG4gICAgZW1haWw6IHRoaXMuZW1haWwgfHwgbnVsbCxcbiAgICBsb2dpbklkOiB0aGlzLmxvZ2luSWQsXG4gICAgc29ja2V0Q29ubmVjdGlvbnM6IFtdLFxuICAgIHNvY2tldElkczogW10sXG4gICAgY3VycmVudFJvb21JZDogdGhpcy5jdXJyZW50Q2hhdD8udG9TdHJpbmcoKSB8fCBudWxsLFxuICAgIHJvb21zOiBbXSxcbiAgfTtcbn0pO1xuXG5leHBvcnQgY29uc3QgQWN0aXZlVXNlck1vZGVsOiBNb2RlbDxBY3RpdmVVc2VyU2NoZW1hRG9jdW1lbnQ+ID1cbiAgbW9kZWxzLkFjdGl2ZVVzZXIgfHwgbW9kZWwoJ0FjdGl2ZVVzZXInLCBhY3RpdmVVc2VyU2NoZW1hKTtcblxuZXhwb3J0IGRlZmF1bHQgQWN0aXZlVXNlck1vZGVsO1xuIl0sIm5hbWVzIjpbIlNjaGVtYSIsIm1vZGVsIiwibW9kZWxzIiwiYWN0aXZlVXNlclNjaGVtYSIsImVtYWlsIiwidHlwZSIsIlR5cGVzIiwiTWl4ZWQiLCJkZWZhdWx0IiwibG9naW5JZCIsIlN0cmluZyIsInJlcXVpcmVkIiwiY3VycmVudENoYXQiLCJPYmplY3RJZCIsInJlZiIsInRpbWVzdGFtcHMiLCJ2aXJ0dWFsIiwiZ2V0IiwiaWQiLCJzb2NrZXRDb25uZWN0aW9ucyIsInNvY2tldElkcyIsImN1cnJlbnRSb29tSWQiLCJ0b1N0cmluZyIsInJvb21zIiwiQWN0aXZlVXNlck1vZGVsIiwiQWN0aXZlVXNlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/server/models/ActiveUserModel.ts\n");

/***/ }),

/***/ "(api)/./src/server/models/ChatModel.ts":
/*!****************************************!*\
  !*** ./src/server/models/ChatModel.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst chatSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    users: [\n        {\n            type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n            ref: \"ActiveUser\"\n        }\n    ],\n    messages: [\n        {\n            type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n            ref: \"Message\"\n        }\n    ]\n}, {\n    timestamps: true\n});\nchatSchema.set(\"toJSON\", {\n    virtuals: true,\n    transform (doc, objectToBeReturned) {\n        objectToBeReturned.id = objectToBeReturned._id.toString();\n    }\n});\nchatSchema.virtual(\"optimizedVersion\").get(function() {\n    return {\n        id: this.id,\n        userIds: this.users.map((i)=>i.toString()),\n        messages: {},\n        createdAt: this.createdAt.getTime()\n    };\n});\nconst Chat = mongoose__WEBPACK_IMPORTED_MODULE_0__.models.Chat || (0,mongoose__WEBPACK_IMPORTED_MODULE_0__.model)(\"Chat\", chatSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Chat);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmVyL21vZGVscy9DaGF0TW9kZWwudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQStFO0FBaUIvRSxNQUFNRyxhQUFhLElBQUlILDRDQUFNQSxDQUMzQjtJQUNFSSxPQUFPO1FBQ0w7WUFDRUMsTUFBTUwsNENBQU1BLENBQUNNLEtBQUssQ0FBQ0MsUUFBUTtZQUMzQkMsS0FBSztRQUNQO0tBQ0Q7SUFDREMsVUFBVTtRQUNSO1lBQ0VKLE1BQU1MLDRDQUFNQSxDQUFDTSxLQUFLLENBQUNDLFFBQVE7WUFDM0JDLEtBQUs7UUFDUDtLQUNEO0FBQ0gsR0FDQTtJQUNFRSxZQUFZO0FBQ2Q7QUFHRlAsV0FBV1EsR0FBRyxDQUFDLFVBQVU7SUFDdkJDLFVBQVU7SUFDVkMsV0FBVUMsR0FBRyxFQUFFQyxrQkFBa0I7UUFDL0JBLG1CQUFtQkMsRUFBRSxHQUFHRCxtQkFBbUJFLEdBQUcsQ0FBQ0MsUUFBUTtJQUN6RDtBQUNGO0FBRUFmLFdBQVdnQixPQUFPLENBQUMsb0JBQW9CQyxHQUFHLENBQUM7SUFDekMsT0FBTztRQUNMSixJQUFJLElBQUksQ0FBQ0EsRUFBRTtRQUNYSyxTQUFTLElBQUksQ0FBQ2pCLEtBQUssQ0FBQ2tCLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUwsUUFBUTtRQUN2Q1QsVUFBVSxDQUFDO1FBQ1hlLFdBQVcsSUFBSSxDQUFDQSxTQUFTLENBQUNDLE9BQU87SUFDbkM7QUFDRjtBQUVBLE1BQU1DLE9BQWtDeEIsNENBQU1BLENBQUN3QixJQUFJLElBQUl6QiwrQ0FBS0EsQ0FBQyxRQUFRRTtBQUVyRSxpRUFBZXVCLElBQUlBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93aGlzY2hhdC8uL3NyYy9zZXJ2ZXIvbW9kZWxzL0NoYXRNb2RlbC50cz9iNWQ2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNjaGVtYSwgRG9jdW1lbnQsIE1vZGVsLCBtb2RlbCwgUG9wdWxhdGVkRG9jLG1vZGVscyB9IGZyb20gJ21vbmdvb3NlJztcbmltcG9ydCB7IEFjdGl2ZVVzZXJTY2hlbWFEb2N1bWVudCB9IGZyb20gJy4vQWN0aXZlVXNlck1vZGVsJztcbmltcG9ydCB7IE1lc3NhZ2VTY2hlbWFEb2N1bWVudCB9IGZyb20gJy4vTWVzc2FnZU1vZGVsJztcblxuaW50ZXJmYWNlIENoYXRTY2hlbWFEb2N1bWVudCBleHRlbmRzIERvY3VtZW50IHtcbiAgdXNlcnM6IFBvcHVsYXRlZERvYzxBY3RpdmVVc2VyU2NoZW1hRG9jdW1lbnQ+W107XG4gIG1lc3NhZ2VzOiBQb3B1bGF0ZWREb2M8TWVzc2FnZVNjaGVtYURvY3VtZW50PltdO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIGlkOiBzdHJpbmc7XG4gIG9wdGltaXplZFZlcnNpb246IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHVzZXJJZHM6IFNjaGVtYS5UeXBlcy5PYmplY3RJZFtdO1xuICAgIG1lc3NhZ2VzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIGNyZWF0ZWRBdDogbnVtYmVyO1xuICB9O1xufVxuXG5jb25zdCBjaGF0U2NoZW1hID0gbmV3IFNjaGVtYTxDaGF0U2NoZW1hRG9jdW1lbnQ+KFxuICB7XG4gICAgdXNlcnM6IFtcbiAgICAgIHtcbiAgICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxuICAgICAgICByZWY6ICdBY3RpdmVVc2VyJyxcbiAgICAgIH0sXG4gICAgXSxcbiAgICBtZXNzYWdlczogW1xuICAgICAge1xuICAgICAgICB0eXBlOiBTY2hlbWEuVHlwZXMuT2JqZWN0SWQsXG4gICAgICAgIHJlZjogJ01lc3NhZ2UnLFxuICAgICAgfSxcbiAgICBdLFxuICB9LFxuICB7XG4gICAgdGltZXN0YW1wczogdHJ1ZSxcbiAgfVxuKTtcblxuY2hhdFNjaGVtYS5zZXQoJ3RvSlNPTicsIHtcbiAgdmlydHVhbHM6IHRydWUsXG4gIHRyYW5zZm9ybShkb2MsIG9iamVjdFRvQmVSZXR1cm5lZCkge1xuICAgIG9iamVjdFRvQmVSZXR1cm5lZC5pZCA9IG9iamVjdFRvQmVSZXR1cm5lZC5faWQudG9TdHJpbmcoKTtcbiAgfSxcbn0pO1xuXG5jaGF0U2NoZW1hLnZpcnR1YWwoJ29wdGltaXplZFZlcnNpb24nKS5nZXQoZnVuY3Rpb24gKHRoaXM6IENoYXRTY2hlbWFEb2N1bWVudCkge1xuICByZXR1cm4ge1xuICAgIGlkOiB0aGlzLmlkLFxuICAgIHVzZXJJZHM6IHRoaXMudXNlcnMubWFwKGkgPT4gaS50b1N0cmluZygpKSxcbiAgICBtZXNzYWdlczoge30sXG4gICAgY3JlYXRlZEF0OiB0aGlzLmNyZWF0ZWRBdC5nZXRUaW1lKCksXG4gIH07XG59KTtcblxuY29uc3QgQ2hhdDogTW9kZWw8Q2hhdFNjaGVtYURvY3VtZW50PiA9IG1vZGVscy5DaGF0IHx8IG1vZGVsKCdDaGF0JywgY2hhdFNjaGVtYSk7XG5cbmV4cG9ydCBkZWZhdWx0IENoYXQ7XG4iXSwibmFtZXMiOlsiU2NoZW1hIiwibW9kZWwiLCJtb2RlbHMiLCJjaGF0U2NoZW1hIiwidXNlcnMiLCJ0eXBlIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsIm1lc3NhZ2VzIiwidGltZXN0YW1wcyIsInNldCIsInZpcnR1YWxzIiwidHJhbnNmb3JtIiwiZG9jIiwib2JqZWN0VG9CZVJldHVybmVkIiwiaWQiLCJfaWQiLCJ0b1N0cmluZyIsInZpcnR1YWwiLCJnZXQiLCJ1c2VySWRzIiwibWFwIiwiaSIsImNyZWF0ZWRBdCIsImdldFRpbWUiLCJDaGF0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/server/models/ChatModel.ts\n");

/***/ }),

/***/ "(api)/./src/server/models/MessageModel.ts":
/*!*******************************************!*\
  !*** ./src/server/models/MessageModel.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst messageSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    message: {\n        type: String,\n        required: true\n    },\n    isEdited: {\n        type: Boolean,\n        default: false\n    },\n    containsBadword: {\n        type: Boolean,\n        default: false,\n        required: true\n    },\n    oldMessages: {\n        type: [\n            String\n        ],\n        default: []\n    },\n    sender: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        required: true,\n        ref: \"ActiveUser\"\n    },\n    type: {\n        type: String,\n        default: \"message\"\n    },\n    isRead: {\n        type: Boolean,\n        default: false\n    },\n    replyTo: {\n        type: String,\n        ref: \"Message\"\n    }\n}, {\n    timestamps: true\n});\nmessageSchema.set(\"toJSON\", {\n    virtuals: true,\n    transform (doc, objectToBeReturned) {\n        objectToBeReturned.id = objectToBeReturned._id.toString();\n    }\n});\nmessageSchema.virtual(\"optimizedVersion\").get(function() {\n    return {\n        id: this.id,\n        message: this.message,\n        time: this.createdAt.getTime(),\n        type: this.type,\n        senderId: this.sender.toString(),\n        isEdited: this.isEdited,\n        containsBadword: this.containsBadword,\n        oldMessages: this.oldMessages,\n        isRead: this.isRead,\n        replyTo: this.replyTo?.toString() || null\n    };\n});\nconst Message = mongoose__WEBPACK_IMPORTED_MODULE_0__.models.Message || (0,mongoose__WEBPACK_IMPORTED_MODULE_0__.model)(\"Message\", messageSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Message);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmVyL21vZGVscy9NZXNzYWdlTW9kZWwudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWdGO0FBNEJoRixNQUFNRyxnQkFBZ0IsSUFBSUgsNENBQU1BLENBQzlCO0lBQ0VJLFNBQVM7UUFDUEMsTUFBTUM7UUFDTkMsVUFBVTtJQUNaO0lBQ0FDLFVBQVU7UUFDUkgsTUFBTUk7UUFDTkMsU0FBUztJQUNYO0lBQ0FDLGlCQUFpQjtRQUNmTixNQUFNSTtRQUNOQyxTQUFTO1FBQ1RILFVBQVU7SUFDWjtJQUNBSyxhQUFhO1FBQ1hQLE1BQU07WUFBQ0M7U0FBTztRQUNkSSxTQUFTLEVBQUU7SUFDYjtJQUNBRyxRQUFRO1FBQ05SLE1BQU1MLDRDQUFNQSxDQUFDYyxLQUFLLENBQUNDLFFBQVE7UUFDM0JSLFVBQVU7UUFDVlMsS0FBSztJQUNQO0lBQ0FYLE1BQU07UUFDSkEsTUFBTUM7UUFDTkksU0FBUztJQUNYO0lBQ0FPLFFBQVE7UUFDTlosTUFBTUk7UUFDTkMsU0FBUztJQUNYO0lBQ0FRLFNBQVM7UUFDUGIsTUFBTUM7UUFDTlUsS0FBSztJQUNQO0FBQ0YsR0FDQTtJQUNFRyxZQUFZO0FBQ2Q7QUFHRmhCLGNBQWNpQixHQUFHLENBQUMsVUFBVTtJQUMxQkMsVUFBVTtJQUNWQyxXQUFVQyxHQUFHLEVBQUVDLGtCQUFrQjtRQUMvQkEsbUJBQW1CQyxFQUFFLEdBQUdELG1CQUFtQkUsR0FBRyxDQUFDQyxRQUFRO0lBQ3pEO0FBQ0Y7QUFFQXhCLGNBQWN5QixPQUFPLENBQUMsb0JBQW9CQyxHQUFHLENBQUM7SUFHNUMsT0FBTztRQUNMSixJQUFJLElBQUksQ0FBQ0EsRUFBRTtRQUNYckIsU0FBUyxJQUFJLENBQUNBLE9BQU87UUFDckIwQixNQUFNLElBQUksQ0FBQ0MsU0FBUyxDQUFDQyxPQUFPO1FBQzVCM0IsTUFBTSxJQUFJLENBQUNBLElBQUk7UUFDZjRCLFVBQVUsSUFBSSxDQUFDcEIsTUFBTSxDQUFDYyxRQUFRO1FBQzlCbkIsVUFBVSxJQUFJLENBQUNBLFFBQVE7UUFDdkJHLGlCQUFpQixJQUFJLENBQUNBLGVBQWU7UUFDckNDLGFBQWEsSUFBSSxDQUFDQSxXQUFXO1FBQzdCSyxRQUFRLElBQUksQ0FBQ0EsTUFBTTtRQUNuQkMsU0FBUyxJQUFJLENBQUNBLE9BQU8sRUFBRVMsY0FBYztJQUN2QztBQUNGO0FBRUEsTUFBTU8sVUFDSmhDLDRDQUFNQSxDQUFDZ0MsT0FBTyxJQUFJakMsK0NBQUtBLENBQUMsV0FBV0U7QUFFckMsaUVBQWUrQixPQUFPQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2hpc2NoYXQvLi9zcmMvc2VydmVyL21vZGVscy9NZXNzYWdlTW9kZWwudHM/ZmUzOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTY2hlbWEsIERvY3VtZW50LCBNb2RlbCwgbW9kZWwsIFBvcHVsYXRlZERvYywgbW9kZWxzIH0gZnJvbSAnbW9uZ29vc2UnO1xuaW1wb3J0IHsgQWN0aXZlVXNlclNjaGVtYURvY3VtZW50IH0gZnJvbSAnLi9BY3RpdmVVc2VyTW9kZWwnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VTY2hlbWFEb2N1bWVudCBleHRlbmRzIERvY3VtZW50IHtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBpc0VkaXRlZDogYm9vbGVhbjtcbiAgY29udGFpbnNCYWR3b3JkOiBib29sZWFuO1xuICBvbGRNZXNzYWdlczogc3RyaW5nW107XG4gIHNlbmRlcjogUG9wdWxhdGVkRG9jPEFjdGl2ZVVzZXJTY2hlbWFEb2N1bWVudD47XG4gIHR5cGU6IHN0cmluZztcbiAgaXNSZWFkOiBib29sZWFuO1xuICByZXBseVRvOiBQb3B1bGF0ZWREb2M8TWVzc2FnZVNjaGVtYURvY3VtZW50PjtcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICBpZDogc3RyaW5nO1xuICBvcHRpbWl6ZWRWZXJzaW9uOiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgdGltZTogbnVtYmVyO1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBzZW5kZXJJZDogc3RyaW5nO1xuICAgIGlzRWRpdGVkOiBib29sZWFuO1xuICAgIGNvbnRhaW5zQmFkd29yZDogYm9vbGVhbjtcbiAgICBvbGRNZXNzYWdlczogc3RyaW5nW107XG4gICAgaXNSZWFkOiBib29sZWFuO1xuICAgIHJlcGx5VG86IHN0cmluZyB8IG51bGw7XG4gIH07XG59XG5cbmNvbnN0IG1lc3NhZ2VTY2hlbWEgPSBuZXcgU2NoZW1hPE1lc3NhZ2VTY2hlbWFEb2N1bWVudD4oXG4gIHtcbiAgICBtZXNzYWdlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICB9LFxuICAgIGlzRWRpdGVkOiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgfSxcbiAgICBjb250YWluc0JhZHdvcmQ6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIH0sXG4gICAgb2xkTWVzc2FnZXM6IHtcbiAgICAgIHR5cGU6IFtTdHJpbmddLFxuICAgICAgZGVmYXVsdDogW10sXG4gICAgfSxcbiAgICBzZW5kZXI6IHtcbiAgICAgIHR5cGU6IFNjaGVtYS5UeXBlcy5PYmplY3RJZCxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgcmVmOiAnQWN0aXZlVXNlcicsXG4gICAgfSxcbiAgICB0eXBlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnbWVzc2FnZScsXG4gICAgfSxcbiAgICBpc1JlYWQ6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICB9LFxuICAgIHJlcGx5VG86IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHJlZjogJ01lc3NhZ2UnLFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB0aW1lc3RhbXBzOiB0cnVlLFxuICB9XG4pO1xuXG5tZXNzYWdlU2NoZW1hLnNldCgndG9KU09OJywge1xuICB2aXJ0dWFsczogdHJ1ZSxcbiAgdHJhbnNmb3JtKGRvYywgb2JqZWN0VG9CZVJldHVybmVkKSB7XG4gICAgb2JqZWN0VG9CZVJldHVybmVkLmlkID0gb2JqZWN0VG9CZVJldHVybmVkLl9pZC50b1N0cmluZygpO1xuICB9LFxufSk7XG5cbm1lc3NhZ2VTY2hlbWEudmlydHVhbCgnb3B0aW1pemVkVmVyc2lvbicpLmdldChmdW5jdGlvbiAoXG4gIHRoaXM6IE1lc3NhZ2VTY2hlbWFEb2N1bWVudFxuKSB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHRoaXMuaWQsXG4gICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlLFxuICAgIHRpbWU6IHRoaXMuY3JlYXRlZEF0LmdldFRpbWUoKSxcbiAgICB0eXBlOiB0aGlzLnR5cGUsXG4gICAgc2VuZGVySWQ6IHRoaXMuc2VuZGVyLnRvU3RyaW5nKCksXG4gICAgaXNFZGl0ZWQ6IHRoaXMuaXNFZGl0ZWQsXG4gICAgY29udGFpbnNCYWR3b3JkOiB0aGlzLmNvbnRhaW5zQmFkd29yZCxcbiAgICBvbGRNZXNzYWdlczogdGhpcy5vbGRNZXNzYWdlcyxcbiAgICBpc1JlYWQ6IHRoaXMuaXNSZWFkLFxuICAgIHJlcGx5VG86IHRoaXMucmVwbHlUbz8udG9TdHJpbmcoKSB8fCBudWxsLFxuICB9O1xufSk7XG5cbmNvbnN0IE1lc3NhZ2U6IE1vZGVsPE1lc3NhZ2VTY2hlbWFEb2N1bWVudD4gPVxuICBtb2RlbHMuTWVzc2FnZSB8fCBtb2RlbCgnTWVzc2FnZScsIG1lc3NhZ2VTY2hlbWEpO1xuXG5leHBvcnQgZGVmYXVsdCBNZXNzYWdlO1xuIl0sIm5hbWVzIjpbIlNjaGVtYSIsIm1vZGVsIiwibW9kZWxzIiwibWVzc2FnZVNjaGVtYSIsIm1lc3NhZ2UiLCJ0eXBlIiwiU3RyaW5nIiwicmVxdWlyZWQiLCJpc0VkaXRlZCIsIkJvb2xlYW4iLCJkZWZhdWx0IiwiY29udGFpbnNCYWR3b3JkIiwib2xkTWVzc2FnZXMiLCJzZW5kZXIiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiaXNSZWFkIiwicmVwbHlUbyIsInRpbWVzdGFtcHMiLCJzZXQiLCJ2aXJ0dWFscyIsInRyYW5zZm9ybSIsImRvYyIsIm9iamVjdFRvQmVSZXR1cm5lZCIsImlkIiwiX2lkIiwidG9TdHJpbmciLCJ2aXJ0dWFsIiwiZ2V0IiwidGltZSIsImNyZWF0ZWRBdCIsImdldFRpbWUiLCJzZW5kZXJJZCIsIk1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/server/models/MessageModel.ts\n");

/***/ }),

/***/ "(api)/./src/server/service/mongo.ts":
/*!*************************************!*\
  !*** ./src/server/service/mongo.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_lib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/lib */ \"(api)/./src/server/lib/lib.ts\");\n\n\n// Initialize variables to store the MongoDB connection and Mongoose instance.\nlet connection = null;\nlet mongooseInstance = null;\n// Retrieve the MongoDB connection string from environment variables.\nconst connectionString = process.env.NEXT_PUBLIC_MongoDB_URL;\n// Async function to establish and return a MongoDB connection.\nconst connectMongo = async ()=>{\n    // Check if the connection string is defined in the environment.\n    if (!connectionString) {\n        throw new mongoose__WEBPACK_IMPORTED_MODULE_0__.Error(\"Connection String is missing, add it to the env file\");\n    }\n    // If a connection already exists, return it.\n    if (connection) {\n        return connection;\n    }\n    try {\n        // Define connection options for MongoDB.\n        const options = {\n            autoIndex: true,\n            family: 4,\n            maxPoolSize: 10,\n            useNewUrlParser: true,\n            useUnifiedTopology: true\n        };\n        mongoose__WEBPACK_IMPORTED_MODULE_0___default().set(\"strictQuery\", false);\n        // Connect to MongoDB and store the Mongoose instance.\n        mongooseInstance = await mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(connectionString, options);\n        // Get the MongoDB connection from the Mongoose instance.\n        connection = mongooseInstance.connection;\n        (0,_lib_lib__WEBPACK_IMPORTED_MODULE_1__.init)().then((done)=>console.log(`sorted the search`)).catch((error)=>console.log(error));\n        // Log a successful database connection.\n        console.log(\"DB connection successful:\", connection.name);\n        // Return the MongoDB connection.\n        return connection;\n    } catch (error) {\n        // Handle any errors that occur during the connection process.\n        const errorMessage = error;\n        console.error(\"DB connection failed:\", errorMessage.message);\n        // Re-throw the error to signal the failure.\n        throw error;\n    }\n};\n// Export the connectMongo function for use in other parts of your application.\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (connectMongo);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmVyL3NlcnZpY2UvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFpRTtBQUMvQjtBQUVsQyw4RUFBOEU7QUFDOUUsSUFBSUcsYUFBZ0M7QUFDcEMsSUFBSUMsbUJBQW9DO0FBRXhDLHFFQUFxRTtBQUNyRSxNQUFNQyxtQkFBbUJDLFFBQVFDLEdBQUcsQ0FBQ0MsdUJBQXVCO0FBRTVELCtEQUErRDtBQUMvRCxNQUFNQyxlQUFlO0lBQ25CLGdFQUFnRTtJQUNoRSxJQUFJLENBQUNKLGtCQUFrQjtRQUNyQixNQUFNLElBQUlKLDJDQUFLQSxDQUFDO0lBQ2xCO0lBRUEsNkNBQTZDO0lBQzdDLElBQUlFLFlBQVk7UUFDZCxPQUFPQTtJQUNUO0lBRUEsSUFBSTtRQUNGLHlDQUF5QztRQUN6QyxNQUFNTyxVQUFVO1lBQ2RDLFdBQVc7WUFDWEMsUUFBUTtZQUNSQyxhQUFhO1lBQ2JDLGlCQUFpQjtZQUNqQkMsb0JBQW9CO1FBQ3RCO1FBRUFmLG1EQUFZLENBQUMsZUFBZTtRQUU1QixzREFBc0Q7UUFDdERJLG1CQUFtQixNQUFNSix1REFBZ0IsQ0FBQ0ssa0JBQWtCSztRQUU1RCx5REFBeUQ7UUFDekRQLGFBQWFDLGlCQUFpQkQsVUFBVTtRQUV4Q0QsOENBQUlBLEdBQ0RnQixJQUFJLENBQUNDLENBQUFBLE9BQVFDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLEdBQzVDQyxLQUFLLENBQUNDLENBQUFBLFFBQVNILFFBQVFDLEdBQUcsQ0FBQ0U7UUFFOUIsd0NBQXdDO1FBQ3hDSCxRQUFRQyxHQUFHLENBQUMsNkJBQTZCbEIsV0FBV3FCLElBQUk7UUFFeEQsaUNBQWlDO1FBQ2pDLE9BQU9yQjtJQUNULEVBQUUsT0FBT29CLE9BQU87UUFDZCw4REFBOEQ7UUFDOUQsTUFBTUUsZUFBZUY7UUFDckJILFFBQVFHLEtBQUssQ0FBQyx5QkFBeUJFLGFBQWFDLE9BQU87UUFFM0QsNENBQTRDO1FBQzVDLE1BQU1IO0lBQ1I7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxpRUFBZWQsWUFBWUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3doaXNjaGF0Ly4vc3JjL3NlcnZlci9zZXJ2aWNlL21vbmdvLnRzPzE4NjUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7IENvbm5lY3Rpb24sIEVycm9yLCBNb25nb29zZSB9IGZyb20gJ21vbmdvb3NlJztcbmltcG9ydCB7IGluaXQgfSBmcm9tICcuLi9saWIvbGliJztcblxuLy8gSW5pdGlhbGl6ZSB2YXJpYWJsZXMgdG8gc3RvcmUgdGhlIE1vbmdvREIgY29ubmVjdGlvbiBhbmQgTW9uZ29vc2UgaW5zdGFuY2UuXG5sZXQgY29ubmVjdGlvbjogQ29ubmVjdGlvbiB8IG51bGwgPSBudWxsO1xubGV0IG1vbmdvb3NlSW5zdGFuY2U6IE1vbmdvb3NlIHwgbnVsbCA9IG51bGw7XG5cbi8vIFJldHJpZXZlIHRoZSBNb25nb0RCIGNvbm5lY3Rpb24gc3RyaW5nIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzLlxuY29uc3QgY29ubmVjdGlvblN0cmluZyA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX01vbmdvREJfVVJMO1xuXG4vLyBBc3luYyBmdW5jdGlvbiB0byBlc3RhYmxpc2ggYW5kIHJldHVybiBhIE1vbmdvREIgY29ubmVjdGlvbi5cbmNvbnN0IGNvbm5lY3RNb25nbyA9IGFzeW5jICgpOiBQcm9taXNlPENvbm5lY3Rpb24+ID0+IHtcbiAgLy8gQ2hlY2sgaWYgdGhlIGNvbm5lY3Rpb24gc3RyaW5nIGlzIGRlZmluZWQgaW4gdGhlIGVudmlyb25tZW50LlxuICBpZiAoIWNvbm5lY3Rpb25TdHJpbmcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nvbm5lY3Rpb24gU3RyaW5nIGlzIG1pc3NpbmcsIGFkZCBpdCB0byB0aGUgZW52IGZpbGUnKTtcbiAgfVxuXG4gIC8vIElmIGEgY29ubmVjdGlvbiBhbHJlYWR5IGV4aXN0cywgcmV0dXJuIGl0LlxuICBpZiAoY29ubmVjdGlvbikge1xuICAgIHJldHVybiBjb25uZWN0aW9uO1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBEZWZpbmUgY29ubmVjdGlvbiBvcHRpb25zIGZvciBNb25nb0RCLlxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBhdXRvSW5kZXg6IHRydWUsXG4gICAgICBmYW1pbHk6IDQsXG4gICAgICBtYXhQb29sU2l6ZTogMTAsXG4gICAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXG4gICAgICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHRydWUsXG4gICAgfTtcblxuICAgIG1vbmdvb3NlLnNldCgnc3RyaWN0UXVlcnknLCBmYWxzZSk7XG5cbiAgICAvLyBDb25uZWN0IHRvIE1vbmdvREIgYW5kIHN0b3JlIHRoZSBNb25nb29zZSBpbnN0YW5jZS5cbiAgICBtb25nb29zZUluc3RhbmNlID0gYXdhaXQgbW9uZ29vc2UuY29ubmVjdChjb25uZWN0aW9uU3RyaW5nLCBvcHRpb25zKTtcblxuICAgIC8vIEdldCB0aGUgTW9uZ29EQiBjb25uZWN0aW9uIGZyb20gdGhlIE1vbmdvb3NlIGluc3RhbmNlLlxuICAgIGNvbm5lY3Rpb24gPSBtb25nb29zZUluc3RhbmNlLmNvbm5lY3Rpb247XG5cbiAgICBpbml0KClcbiAgICAgIC50aGVuKGRvbmUgPT4gY29uc29sZS5sb2coYHNvcnRlZCB0aGUgc2VhcmNoYCkpXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coZXJyb3IpKTtcblxuICAgIC8vIExvZyBhIHN1Y2Nlc3NmdWwgZGF0YWJhc2UgY29ubmVjdGlvbi5cbiAgICBjb25zb2xlLmxvZygnREIgY29ubmVjdGlvbiBzdWNjZXNzZnVsOicsIGNvbm5lY3Rpb24ubmFtZSk7XG5cbiAgICAvLyBSZXR1cm4gdGhlIE1vbmdvREIgY29ubmVjdGlvbi5cbiAgICByZXR1cm4gY29ubmVjdGlvbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBIYW5kbGUgYW55IGVycm9ycyB0aGF0IG9jY3VyIGR1cmluZyB0aGUgY29ubmVjdGlvbiBwcm9jZXNzLlxuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yIGFzIEVycm9yO1xuICAgIGNvbnNvbGUuZXJyb3IoJ0RCIGNvbm5lY3Rpb24gZmFpbGVkOicsIGVycm9yTWVzc2FnZS5tZXNzYWdlKTtcblxuICAgIC8vIFJlLXRocm93IHRoZSBlcnJvciB0byBzaWduYWwgdGhlIGZhaWx1cmUuXG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn07XG5cbi8vIEV4cG9ydCB0aGUgY29ubmVjdE1vbmdvIGZ1bmN0aW9uIGZvciB1c2UgaW4gb3RoZXIgcGFydHMgb2YgeW91ciBhcHBsaWNhdGlvbi5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RNb25nbztcbiJdLCJuYW1lcyI6WyJtb25nb29zZSIsIkVycm9yIiwiaW5pdCIsImNvbm5lY3Rpb24iLCJtb25nb29zZUluc3RhbmNlIiwiY29ubmVjdGlvblN0cmluZyIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19Nb25nb0RCX1VSTCIsImNvbm5lY3RNb25nbyIsIm9wdGlvbnMiLCJhdXRvSW5kZXgiLCJmYW1pbHkiLCJtYXhQb29sU2l6ZSIsInVzZU5ld1VybFBhcnNlciIsInVzZVVuaWZpZWRUb3BvbG9neSIsInNldCIsImNvbm5lY3QiLCJ0aGVuIiwiZG9uZSIsImNvbnNvbGUiLCJsb2ciLCJjYXRjaCIsImVycm9yIiwibmFtZSIsImVycm9yTWVzc2FnZSIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/server/service/mongo.ts\n");

/***/ }),

/***/ "(api)/./src/shared/constants/constants.ts":
/*!*******************************************!*\
  !*** ./src/shared/constants/constants.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst events = {\n    NEW_EVENT_CLOSE: \"close\",\n    NEW_EVENT_INACTIVE: \"inactive\",\n    NEW_EVENT_DELETE_MESSAGE: \"delete_message\",\n    NEW_EVENT_EDIT_MESSAGE: \"edit_message\",\n    NEW_EVENT_JOIN: \"join\",\n    NEW_EVENT_JOINED: \"joined\",\n    NEW_EVENT_CHAT_RESTORE: \"chat_restore\",\n    NEW_EVENT_LOGOUT: \"logout\",\n    NEW_EVENT_SEND_MESSAGE: \"send_message\",\n    NEW_EVENT_SEND_FAILED: \"send_failed\",\n    NEW_EVENT_RECEIVE_MESSAGE: \"receive_message\",\n    NEW_EVENT_STOP_SEARCH: \"stop_search\",\n    NEW_EVENT_STOP_SEARCH_SUCCESS: \"stop_search_success\",\n    NEW_EVENT_TYPING: \"typing\",\n    NEW_EVENT_DISPLAY: \"display\",\n    NEW_EVENT_ADDING: \"adding\",\n    NEW_EVENT_CREATE_ROOM: \"createRoom\",\n    NEW_EVENT_READ_MESSAGE: \"read_message\",\n    NEW_EVENT_ONLINE_STATUS: \"online_status\"\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (events);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2hhcmVkL2NvbnN0YW50cy9jb25zdGFudHMudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU1BLFNBQVM7SUFDYkMsaUJBQWlCO0lBQ2pCQyxvQkFBb0I7SUFDcEJDLDBCQUEwQjtJQUMxQkMsd0JBQXdCO0lBQ3hCQyxnQkFBZ0I7SUFDaEJDLGtCQUFrQjtJQUNsQkMsd0JBQXdCO0lBQ3hCQyxrQkFBa0I7SUFDbEJDLHdCQUF3QjtJQUN4QkMsdUJBQXVCO0lBQ3ZCQywyQkFBMkI7SUFDM0JDLHVCQUF1QjtJQUN2QkMsK0JBQStCO0lBQy9CQyxrQkFBa0I7SUFDbEJDLG1CQUFtQjtJQUNuQkMsa0JBQWtCO0lBQ2xCQyx1QkFBdUI7SUFDdkJDLHdCQUF3QjtJQUN4QkMseUJBQXlCO0FBQzNCO0FBRUEsaUVBQWVuQixNQUFNQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2hpc2NoYXQvLi9zcmMvc2hhcmVkL2NvbnN0YW50cy9jb25zdGFudHMudHM/YWNkMCJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBldmVudHMgPSB7XG4gIE5FV19FVkVOVF9DTE9TRTogJ2Nsb3NlJyxcbiAgTkVXX0VWRU5UX0lOQUNUSVZFOiAnaW5hY3RpdmUnLFxuICBORVdfRVZFTlRfREVMRVRFX01FU1NBR0U6ICdkZWxldGVfbWVzc2FnZScsXG4gIE5FV19FVkVOVF9FRElUX01FU1NBR0U6ICdlZGl0X21lc3NhZ2UnLFxuICBORVdfRVZFTlRfSk9JTjogJ2pvaW4nLFxuICBORVdfRVZFTlRfSk9JTkVEOiAnam9pbmVkJyxcbiAgTkVXX0VWRU5UX0NIQVRfUkVTVE9SRTogJ2NoYXRfcmVzdG9yZScsXG4gIE5FV19FVkVOVF9MT0dPVVQ6ICdsb2dvdXQnLFxuICBORVdfRVZFTlRfU0VORF9NRVNTQUdFOiAnc2VuZF9tZXNzYWdlJyxcbiAgTkVXX0VWRU5UX1NFTkRfRkFJTEVEOiAnc2VuZF9mYWlsZWQnLFxuICBORVdfRVZFTlRfUkVDRUlWRV9NRVNTQUdFOiAncmVjZWl2ZV9tZXNzYWdlJyxcbiAgTkVXX0VWRU5UX1NUT1BfU0VBUkNIOiAnc3RvcF9zZWFyY2gnLFxuICBORVdfRVZFTlRfU1RPUF9TRUFSQ0hfU1VDQ0VTUzogJ3N0b3Bfc2VhcmNoX3N1Y2Nlc3MnLFxuICBORVdfRVZFTlRfVFlQSU5HOiAndHlwaW5nJyxcbiAgTkVXX0VWRU5UX0RJU1BMQVk6ICdkaXNwbGF5JyxcbiAgTkVXX0VWRU5UX0FERElORzogJ2FkZGluZycsXG4gIE5FV19FVkVOVF9DUkVBVEVfUk9PTTogJ2NyZWF0ZVJvb20nLFxuICBORVdfRVZFTlRfUkVBRF9NRVNTQUdFOiAncmVhZF9tZXNzYWdlJyxcbiAgTkVXX0VWRU5UX09OTElORV9TVEFUVVM6ICdvbmxpbmVfc3RhdHVzJyxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGV2ZW50cztcbiJdLCJuYW1lcyI6WyJldmVudHMiLCJORVdfRVZFTlRfQ0xPU0UiLCJORVdfRVZFTlRfSU5BQ1RJVkUiLCJORVdfRVZFTlRfREVMRVRFX01FU1NBR0UiLCJORVdfRVZFTlRfRURJVF9NRVNTQUdFIiwiTkVXX0VWRU5UX0pPSU4iLCJORVdfRVZFTlRfSk9JTkVEIiwiTkVXX0VWRU5UX0NIQVRfUkVTVE9SRSIsIk5FV19FVkVOVF9MT0dPVVQiLCJORVdfRVZFTlRfU0VORF9NRVNTQUdFIiwiTkVXX0VWRU5UX1NFTkRfRkFJTEVEIiwiTkVXX0VWRU5UX1JFQ0VJVkVfTUVTU0FHRSIsIk5FV19FVkVOVF9TVE9QX1NFQVJDSCIsIk5FV19FVkVOVF9TVE9QX1NFQVJDSF9TVUNDRVNTIiwiTkVXX0VWRU5UX1RZUElORyIsIk5FV19FVkVOVF9ESVNQTEFZIiwiTkVXX0VWRU5UX0FERElORyIsIk5FV19FVkVOVF9DUkVBVEVfUk9PTSIsIk5FV19FVkVOVF9SRUFEX01FU1NBR0UiLCJORVdfRVZFTlRfT05MSU5FX1NUQVRVUyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/shared/constants/constants.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fserver&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cserver%5Cindex.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();